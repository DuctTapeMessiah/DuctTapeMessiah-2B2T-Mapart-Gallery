<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>DuctTapeMessiah — 2B2T Mapart Gallery</title>
<link rel="canonical" href="https://ducttapemessiah.art"/>
<meta property="og:type" content="website">
<meta property="og:title" content="DuctTapeMessiah — 2B2T Mapart Gallery">
<meta property="og:url" content="https://ducttapemessiah.art">
<meta property="og:description" content="DTM's Mapart on 2B2T">
<meta property="og:image" content="https://ducttapemessiah.art/preview.jpeg">
<meta name="twitter:image" content="https://ducttapemessiah.art/preview.jpeg">
<meta name="twitter:card" content="summary_large_image">
<meta name="theme-color" content="#6ee7b7">
<link rel="icon" href="/images/DTM.png">
<style>
:root{
  --bg:#0b0b0d; --panel:#0f1113; --muted:#94a3b8;
  --accent:#6ee7b7; --glass:rgba(255,255,255,0.03);
  --card-shadow:0 6px 18px rgba(2,6,23,0.6);
  font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
}
html,body{margin:0;height:100%;background:linear-gradient(180deg,var(--bg),#050506 120%);color:#e6eef6;}
.wrap{max-width:1200px;margin:28px auto;padding:18px;}
header{display:flex;align-items:center;gap:18px;margin-bottom:24px;flex-wrap:wrap;}
.logo{width:80px;height:80px;border-radius:12px;overflow:hidden;flex-shrink:0;}
.logo img{width:100%;height:100%;object-fit:cover;}
h1{font-size:20px;margin:0;font-weight:600;}
.controls{display:flex;gap:12px;align-items:center;margin:12px 0;flex-wrap:wrap;justify-content:space-between;}
.sort-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;min-width:320px;max-width:720px;width:60%;}
.sort-btn{background:var(--panel);border:1px solid rgba(255,255,255,0.08);padding:9px 12px;border-radius:10px;color:inherit;font-size:14px;cursor:pointer;transition:all .12s;display:flex;align-items:center;justify-content:center;}
.sort-btn.active{background:var(--accent);color:#000;font-weight:600;border-color:var(--accent);}
.sort-btn:hover:not(.active){background:rgba(255,255,255,0.06);}
.search-input{background:var(--panel);border:1px solid rgba(255,255,255,0.03);padding:8px 12px;border-radius:8px;color:inherit;font-size:14px;min-width:240px;}
.stats{margin-left:auto;display:flex;gap:16px;align-items:center;color:var(--muted);font-size:14px;font-weight:500;}
.grid{display:grid;grid-auto-flow:dense;grid-template-columns:repeat(auto-fill,minmax(128px,1fr));gap:12px;margin-top:16px;}
.card{background:var(--glass);border-radius:10px;overflow:hidden;border:1px solid rgba(255,255,255,0.02);box-shadow:var(--card-shadow);transition:transform .12s;display:flex;flex-direction:column;}
.card:hover{transform:translateY(-6px);}
.thumb-wrapper{position:relative;width:100%;max-width:384px;max-height:320px;align-self:center;overflow:hidden;border-radius:6px;}
.thumb{width:100%;height:100%;object-fit:contain;background:#000;image-rendering:pixelated;box-shadow:inset 0 -30px 60px rgba(0,0,0,0.4);cursor:pointer;}
.modal{position:fixed;inset:0;background:rgba(3,6,10,0.94);display:flex;align-items:center;justify-content:center;padding:20px;z-index:80;opacity:0;pointer-events:none;transition:opacity .25s;}
.modal.open{opacity:1;pointer-events:auto;}
#modalInner{display:flex;flex-direction:column;width:calc(100vw - 40px);height:80vh;max-width:1400px;border-radius:12px;overflow:hidden;background:var(--panel);box-shadow:0 40px 100px rgba(0,0,0,0.9);position:relative;}
.modal-viewport{flex:1;overflow:hidden;display:flex;align-items:center;justify-content:center;background:#000;position:relative;}
.modal-panzoom{width:100%;height:100%;display:flex;align-items:center;justify-content:center;cursor:grab;touch-action:none;user-select:none;}
.modal-panzoom:active{cursor:grabbing;}
.modal-img{max-width:none;max-height:none;image-rendering:pixelated;user-select:none;pointer-events:none;transition:transform .15s ease-out;}
.modal-controls{background:rgba(15,17,19,0.95);backdrop-filter:blur(12px);padding:16px;z-index:10;display:flex;flex-direction:column;gap:8px;}
.modal-meta{color:var(--muted);font-size:13px;line-height:1.6;}
.arrow-btn{position:absolute;top:50%;transform:translateY(-50%);background:var(--panel);border-radius:50%;padding:12px;cursor:pointer;z-index:100;font-size:24px;color:#fff;user-select:none;}
.arrow-left{left:12px;}
.arrow-right{right:12px;}
.pan-slider{width:100%;margin:4px 0;}
@media (max-width:960px){.sort-grid{width:100%;}}
@media (max-width:560px){.grid{grid-template-columns:repeat(2,1fr);}.wrap{margin:12px;padding:12px;}}
</style>
</head>
<body>
<div class="wrap">
<header>
<div class="logo"><img src="images/DTM.png" alt="DTM"></div>
<div><h1>DuctTapeMessiah — 2B2T Mapart Gallery</h1></div>
<div class="stats" id="stats">
<div>Entries: <span id="totalCount">0</span></div>
<div>Total: <span id="totalTiles">0</span> maps</div>
</div>
</header>
<div class="controls">
<div class="sort-grid" role="toolbar" aria-label="Sort gallery">
<button id="sortNewest" class="sort-btn" data-sort="date-desc">Newest First</button>
<button id="sortLargest" class="sort-btn" data-sort="size-desc">Largest First</button>
<button id="sortOldest" class="sort-btn" data-sort="date-asc">Oldest First</button>
<button id="sortSmallest" class="sort-btn" data-sort="size-asc">Smallest First</button>
</div>
<input id="search" class="search-input" placeholder="Search title..." type="text">
</div>
<div class="grid" id="gallery"></div>
</div>

<div id="modal" class="modal" aria-hidden="true">
<div class="close-x" id="modalClose" role="button" aria-label="Close">×</div>
<div id="modalInner">
<div class="modal-viewport">
<div class="modal-panzoom" id="panzoom">
<img id="modalImg" class="modal-img" src="" alt="">
</div>
</div>
<div class="arrow-btn arrow-left" id="prevBtn">‹</div>
<div class="arrow-btn arrow-right" id="nextBtn">›</div>
<div class="modal-controls">
<label>Zoom:<input type="range" id="zoomSlider" min="30" max="500" value="100" step="5"></label>
<label>Pan X:<input type="range" id="panXSlider" class="pan-slider" min="-200" max="200" value="0"></label>
<label>Pan Y:<input type="range" id="panYSlider" class="pan-slider" min="-200" max="200" value="0"></label>
<div class="modal-meta" id="modalMeta"></div>
<button id="resetZoom" style="padding:6px 12px;font-size:12px;">Fit Screen</button>
</div>
</div>
</div>

<script>
let mapsList=[],currentIndex=0;
const gallery=document.getElementById('gallery');
const modal=document.getElementById('modal');
const modalImg=document.getElementById('modalImg');
const panzoom=document.getElementById('panzoom');
const modalMeta=document.getElementById('modalMeta');
const zoomSlider=document.getElementById('zoomSlider');
const panXSlider=document.getElementById('panXSlider');
const panYSlider=document.getElementById('panYSlider');
const resetZoomBtn=document.getElementById('resetZoom');
const prevBtn=document.getElementById('prevBtn');
const nextBtn=document.getElementById('nextBtn');

let currentScale=1,translateX=0,translateY=0,isPanning=false,startX=0,startY=0;

function updateTransform(){
  modalImg.style.transform=`translate(${translateX}px,${translateY}px) scale(${currentScale})`;
  panXSlider.value = translateX;
  panYSlider.value = translateY;
}

function fitToScreen(){
  if(!modalImg.naturalWidth) return;
  const vp=panzoom.getBoundingClientRect();
  const scale=Math.min(vp.width/modalImg.naturalWidth,vp.height/modalImg.naturalHeight);
  currentScale=scale; translateX=0; translateY=0;
  zoomSlider.value=currentScale*100;
  updateTransform();
}

function openModal(index){
  currentIndex=index;
  const m=mapsList[index];
  modal.classList.add('open'); document.body.style.overflow='hidden';
  modalImg.src=m.image; modalImg.alt=m.title;
  modalMeta.innerHTML=`<strong>${m.title}</strong>`;
  modalImg.onload=()=>{fitToScreen();}
}

function closeModal(){modal.classList.remove('open'); document.body.style.overflow='';}

function showNext(){openModal((currentIndex+1)%mapsList.length);}
function showPrev(){openModal((currentIndex-1+mapsList.length)%mapsList.length);}

// Panning
const startPan=(x,y)=>{isPanning=true;startX=x-translateX;startY=y-translateY;};
const movePan=(x,y)=>{if(!isPanning) return;translateX=x-startX;translateY=y-startY;updateTransform();}
panzoom.onmousedown=e=>startPan(e.clientX,e.clientY);
document.onmousemove=e=>movePan(e.clientX,e.clientY);
document.onmouseup=()=>isPanning=false;

zoomSlider.oninput=()=>{currentScale=zoomSlider.value/100;updateTransform();};
panXSlider.oninput=()=>{translateX=parseInt(panXSlider.value);updateTransform();}
panYSlider.oninput=()=>{translateY=parseInt(panYSlider.value);updateTransform();}

panzoom.addEventListener('wheel',e=>{
  e.preventDefault();
  const rect=panzoom.getBoundingClientRect();
  const mouseX=e.clientX-rect.left;
  const mouseY=e.clientY-rect.top;
  const delta=e.deltaY<0?1.1:0.9;
  const prevScale=currentScale;
  currentScale=Math.min(Math.max(currentScale*delta,0.1),5);
  translateX-=(mouseX-rect.width/2)/prevScale*(currentScale-prevScale);
  translateY-=(mouseY-rect.height/2)/prevScale*(currentScale-prevScale);
  zoomSlider.value=Math.round(currentScale*100);
  updateTransform();
},{passive:false});

prevBtn.onclick=showPrev; nextBtn.onclick=showNext;
document.addEventListener('keydown',e=>{
  if(!modal.classList.contains('open')) return;
  if(e.key==='ArrowLeft') showPrev();
  if(e.key==='ArrowRight') showNext();
  if(e.key==='Escape') closeModal();
});

async function loadMaps(){
  const r=await fetch('maps.json');
  const data=await r.json();
  mapsList=data;
  gallery.innerHTML='';
  data.forEach((m,i)=>{
    const card=document.createElement('div'); card.className='card';
    const img=document.createElement('img'); img.className='thumb'; img.src=m.image; img.alt=m.title;
    img.onclick=()=>openModal(i);
    card.appendChild(img);
    gallery.appendChild(card);
  });
}
document.getElementById('modalClose').onclick=closeModal;
resetZoomBtn.onclick=fitToScreen;

loadMaps().catch(console.error);
</script>
</body>
</html>
