<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>DuctTapeMessiah — 2B2T Gallery</title>
    <link rel="canonical" href="https://ducttapemessiah.art"/>

    <style>
        :root{
            --bg:#0b0b0d;
            --panel:#0f1113;
            --muted:#94a3b8;
            --accent:#b6c7d6;
            --glass:rgba(255,255,255,.035);
            --overlay-glass:rgba(15,17,19,.85);
            --shadow:0 10px 30px rgba(0,0,0,.65);
            font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;
        }
        html,body{margin:0;background:linear-gradient(180deg,var(--bg),#050506 120%);color:#e6eef6}
        .wrap{max-width:1200px;margin:28px auto;padding:18px}
        header{display:flex;align-items:center;gap:18px;margin-bottom:18px}
        .logo{width:72px;height:72px;border-radius:12px;overflow:hidden}
        .logo img{width:100%;height:100%;object-fit:cover}
        .title-main{font-size:26px;font-weight:800}
        .title-sub{font-size:15px;color:var(--muted)}

        .controls{display:flex;gap:14px;flex-wrap:wrap;margin-bottom:10px}
        .tabs{display:flex;gap:8px}
        .tab-btn,.sort-btn{
            background:var(--panel);
            border:1px solid rgba(255,255,255,.08);
            padding:9px 14px;
            border-radius:10px;
            color:inherit;
            cursor:pointer
        }
        .tab-btn.active,.sort-btn.active{
            background:var(--accent);
            color:#000;
            font-weight:700
        }
        .search-input{
            background:var(--panel);
            border:1px solid rgba(255,255,255,.05);
            padding:9px 14px;
            border-radius:10px;
            color:inherit
        }

        .grid{
            display:grid;
            grid-template-columns:repeat(auto-fill,minmax(250px,1fr));
            gap:16px;
            margin-top:16px;
            padding-top:90px
        }
        .card{background:var(--glass);border-radius:12px;overflow:hidden;box-shadow:var(--shadow)}
        .thumb-wrapper{aspect-ratio:1/1;background:#000}
        .thumb{width:100%;height:100%;object-fit:contain;image-rendering:pixelated;cursor:pointer}

        .modal{
            position:fixed;inset:0;
            background:rgba(3,6,10,.96);
            display:flex;
            opacity:0;
            pointer-events:none;
            transition:.25s;
            z-index:100
        }
        .modal.open{opacity:1;pointer-events:auto}

        .modal-viewport{
            flex:1;
            position:relative;
            overflow:hidden;
            display:flex;
            align-items:center;
            justify-content:center;
            touch-action:none
        }
        .modal-img{
            user-select:none;
            image-rendering:pixelated;
            transform-origin:center;
            cursor:grab
        }
        .modal-img:active{cursor:grabbing}

        .nav-arrow{
            position:absolute;
            top:50%;
            transform:translateY(-50%);
            font-size:34px;
            padding:14px 18px;
            background:rgba(0,0,0,.55);
            border-radius:12px;
            cursor:pointer;
            opacity:.25;
            transition:opacity .4s
        }
        .nav-arrow.prev{left:20px}
        .nav-arrow.next{right:20px}
        .nav-arrow.visible{opacity:.9}

        .modal-overlay{
            position:absolute;
            bottom:24px;
            left:50%;
            transform:translateX(-50%);
            background:var(--overlay-glass);
            backdrop-filter:blur(12px);
            padding:16px 26px;
            border-radius:18px;
            max-width:92%;
            text-align:center;
            box-shadow:0 8px 30px rgba(0,0,0,.6)
        }
        .modal-overlay strong{font-size:18px}
        .modal-overlay .date{font-size:13px;color:var(--muted)}
        .modal-overlay .desc{font-size:14px;margin-top:8px;line-height:1.5}

        .modal-controls{
            position:absolute;
            bottom:24px;
            right:24px;
            background:var(--overlay-glass);
            backdrop-filter:blur(12px);
            padding:12px;
            border-radius:14px;
            font-size:11px;
            display:flex;
            flex-direction:column;
            gap:6px;
            opacity:.25;
            transition:opacity .4s
        }
        .modal-controls.visible{opacity:.9}

        .slider-row{display:flex;align-items:center;gap:8px}
        .slider-row input{flex:1}

        .close-x{
            position:absolute;
            top:18px;
            right:18px;
            font-size:22px;
            background:var(--panel);
            padding:8px 12px;
            border-radius:10px;
            cursor:pointer
        }
    </style>
</head>

<body>
<div class="wrap">
    <header>
        <div class="logo"><img src="images/DTM.png"></div>
        <div>
            <div class="title-main">DuctTapeMessiah</div>
            <div class="title-sub">2B2T Gallery</div>
        </div>
    </header>

    <div class="controls">
        <div class="tabs">
            <button id="tabMapart" class="tab-btn active">Mapart</button>
            <button id="tabScreens" class="tab-btn">Screenshots</button>
        </div>
        <input id="search" class="search-input" placeholder="Search">
    </div>

    <div id="gallery" class="grid"></div>
</div>

<div id="modal" class="modal">
    <div class="close-x" id="closeBtn">×</div>
    <div class="modal-viewport" id="viewport">
        <img id="modalImg" class="modal-img">
        <div class="nav-arrow prev" id="prev">‹</div>
        <div class="nav-arrow next" id="next">›</div>
    </div>
    <div class="modal-overlay" id="overlay"></div>
    <div class="modal-controls" id="controls">
        <button id="resetView">Reset View</button>
        <div class="slider-row">Zoom <input id="zoom" type="range" min="0.1" max="6" step="0.01"></div>
    </div>
</div>

<script>
    const gallery = document.getElementById('gallery');
    const modal = document.getElementById('modal');
    const img = document.getElementById('modalImg');
    const viewport = document.getElementById('viewport');
    const overlay = document.getElementById('overlay');
    const zoom = document.getElementById('zoom');
    const controls = document.getElementById('controls');

    let DATA=[], SHOTS=[], items=[], index=0;
    let state={scale:1,x:0,y:0,drag:false,sx:0,sy:0};

    const dateFromFilename = p=>{
        const m=p.match(/(\d{4}-\d{2}-\d{2})/);
        return m?m[1]:'';
    };

    async function load(u){try{return(await fetch(u)).json()}catch{return[]}}

    async function boot(){
        DATA=await load('maps.json');
        SHOTS=(await load('screenshots.json')).map(s=>({
            ...s,
            date:s.date||dateFromFilename(s.image),
            title:s.title||dateFromFilename(s.image)
        }));
        render(DATA);
    }

    function render(arr){
        gallery.innerHTML='';
        items=arr;
        arr.forEach((m,i)=>{
            const d=document.createElement('div');
            d.className='card';
            d.innerHTML=`<div class="thumb-wrapper"><img class="thumb" src="${m.image}"></div>`;
            d.onclick=()=>open(i);
            gallery.appendChild(d);
        });
    }

    function clampPan(){
        const iw=img.naturalWidth*state.scale;
        const ih=img.naturalHeight*state.scale;
        const vw=viewport.clientWidth;
        const vh=viewport.clientHeight;
        const maxX=Math.max(0,(iw-vw)/2);
        const maxY=Math.max(0,(ih-vh)/2);
        state.x=Math.min(maxX,Math.max(-maxX,state.x));
        state.y=Math.min(maxY,Math.max(-maxY,state.y));
    }

    function apply(){
        clampPan();
        img.style.transform=`translate(${state.x}px,${state.y}px) scale(${state.scale})`;
        zoom.value=state.scale;
    }

    function reset(){
        const s=Math.min(
            viewport.clientWidth/img.naturalWidth,
            viewport.clientHeight/img.naturalHeight
        );
        state={...state,scale:s,x:0,y:0};
        apply();
    }

    function open(i){
        index=i;
        const m=items[i];
        img.src=m.image;
        overlay.innerHTML=`<strong>${m.title||''}</strong>
            <div class="date">${m.date||''}</div>
            <div class="desc">${m.description||''}</div>`;
        modal.classList.add('open');
        document.body.style.overflow='hidden';
        img.onload=reset;
    }

    img.onmousedown=e=>{
        state.drag=true;
        state.sx=e.clientX-state.x;
        state.sy=e.clientY-state.y;
    };
    window.onmouseup=()=>state.drag=false;
    window.onmousemove=e=>{
        if(!state.drag)return;
        state.x=e.clientX-state.sx;
        state.y=e.clientY-state.sy;
        apply();
    };

    zoom.oninput=()=>{state.scale=parseFloat(zoom.value);apply()};
    document.getElementById('resetView').onclick=reset;
    document.getElementById('closeBtn').onclick=()=>{modal.classList.remove('open');document.body.style.overflow='';};

    boot();
</script>
</body>
</html>
