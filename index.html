<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>DuctTapeMessiah ‚Äî 2B2T Gallery</title>
    <meta name="description" content="A collection of Mapart created and screenshots captured by DuctTapeMessiah on the Oldest Anarchy server in Minecraft, 2B2T.">
    <link rel="canonical" href="https://ducttapemessiah.art"/>

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://ducttapemessiah.art/">
    <meta property="og:title" content="DuctTapeMessiah ‚Äî 2B2T Gallery">
    <meta property="og:description" content="A collection of mapart created and screenshots captured by DuctTapeMessiah on the Oldest Anarchy server in Minecraft, 2B2T.">
    <meta property="og:image" content="https://ducttapemessiah.art/preview1.jpeg">

    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://ducttapemessiah.art/">
    <meta property="twitter:title" content="DuctTapeMessiah ‚Äî 2B2T Gallery">
    <meta property="twitter:description" content="A collection of mapart created and screenshots captured by DuctTapeMessiah on the Oldest Anarchy server in Minecraft, 2B2T.">
    <meta property="twitter:image" content="https://ducttapemessiah.art/preview1.jpeg">

    <style>
        :root {
            --bg: #0b0b0d;
            --panel: #0f1113;
            --muted: #94a3b8;
            --accent: #b6c7d6;
            --accent-bright: #d4e3f2;
            --glass: rgba(255,255,255,.06);
            --overlay-glass: rgba(15,17,19,.45);
            --shadow: 0 10px 30px rgba(0,0,0,.65);
            --content-max: 1200px;
            font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
        }

        html, body {
            margin: 0;
            height: 100%;
            color: #e6eef6;
            overflow-x: hidden;
        }

        html {
            background: var(--bg);
        }

        .panel {
            background: var(--glass);
            border: 1px solid rgba(255,255,255,.08);
            border-radius: 12px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(6px);
        }

        .bg-layer {
            position: fixed;
            inset: 0;
            z-index: -1;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            filter: brightness(0.4) blur(2px);
            opacity: 0;
            transition: opacity 3s ease-in-out;
            will-change: opacity, transform;
        }

        .bg-layer.active    { opacity: 1; }
        .bg-layer.fadeout   { opacity: 0; }
        .bg-layer.animate   { animation: bgZoom 12s linear forwards; }

        @keyframes bgZoom {
            from { transform: scale(1); }
            to   { transform: scale(1.08); }
        }

        .wrap {
            max-width: 1200px;
            margin: 24px auto;
            padding: 0 16px;
            opacity: 0;
            transition: opacity 1.2s ease;
        }

        body.loaded .wrap {
            opacity: 1;
        }

        .info-section {
            margin: 32px 0;
        }

        .top-header-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 32px;
        }

        header, .award-banner, .contact-card {
            padding: 20px;
        }

        header {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
            background: var(--glass);
            border: 1px solid rgba(255,255,255,.08);
            border-radius: 12px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(8px);
            text-align: center;
            padding: 24px 20px;
        }

        .logo {
            width: 70px;
            height: 70px;
            border-radius: 12px;
            overflow: hidden;
            flex-shrink: 0;
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .title-main {
            font-size: 28px;
            font-weight: 800;
            color: #f1f5f9;
            line-height: 1.1;
        }

        .title-sub {
            font-size: 14px;
            color: #cbd5e1;
            font-weight: 500;
        }

        .award-banner {
            background: var(--glass);
            border: 1px solid rgba(255,255,255,.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
            text-align: center;
            padding: 24px 20px;
        }

        .award-icon {
            font-size: 36px;
            flex-shrink: 0;
        }

        .award-title {
            font-size: 16px;
            font-weight: 800;
            color: #f1f5f9;
            margin-bottom: 2px;
        }

        .award-subtitle {
            font-size: 13px;
            color: #cbd5e1;
        }

        .award-link {
            font-size: 11px;
            color: #a5b4fc;
            text-decoration: none;
        }

        .award-link:hover {
            color: #c7d2fe;
            text-decoration: underline;
        }

        .contact-card {
            text-align: center;
        }

        .social-label {
            font-size: 13px;
            font-weight: 700;
            color: var(--accent-bright);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
        }

        .social-links {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            font-size: 14px;
            margin-bottom: 12px;
            justify-content: center;
        }

        .social-links a {
            color: var(--accent);
            text-decoration: none;
        }

        .social-links a:hover {
            color: var(--accent-bright);
            text-decoration: underline;
        }

        .free-maps {
            font-size: 15px;
            color: var(--accent-bright);
            font-weight: 600;
        }

        .stats-grid {
            display: grid;
            gap: 24px;
        }

        .stat-card {
            background: var(--glass);
            border: 1px solid rgba(255,255,255,.06);
            border-radius: 12px;
            padding: 24px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(6px);
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .stat-label {
            font-size: 12px;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 800;
            color: var(--accent-bright);
            line-height: 1;
        }

        .stat-sublabel {
            font-size: 11px;
            color: var(--muted);
            margin-top: 4px;
        }

        .group-projects {
            padding: 14px 16px;
            display: flex;
            flex-direction: column;
        }

        .group-projects-title {
            font-size: 11px;
            font-weight: 700;
            color: var(--accent-bright);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-align: center;
            flex-shrink: 0;
        }

        .project-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
            flex: 1;
            overflow-y: auto;
        }

        .project-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 8px;
            background: rgba(255,255,255,.02);
            border-radius: 6px;
            font-size: 10px;
        }

        .project-name {
            color: var(--accent);
            font-weight: 600;
        }

        .project-date {
            color: var(--muted);
            font-size: 9px;
            margin-right: 6px;
        }

        .project-maps {
            color: var(--accent-bright);
            font-weight: 700;
            font-size: 10px;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 14px;
            align-items: center;
            margin-bottom: 32px;
        }

        .tabs {
            display: flex;
            gap: 8px;
        }

        .tab-btn, .sort-btn {
            background: var(--panel);
            border: 1px solid rgba(255,255,255,.08);
            padding: 9px 14px;
            border-radius: 10px;
            color: inherit;
            font-size: 14px;
            cursor: pointer;
            transition: .12s;
        }

        .tab-btn.active, .sort-btn.active {
            background: var(--accent);
            color: #000;
            font-weight: 700;
        }

        .sort-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            min-width: 280px;
        }

        .search-input {
            background: var(--panel);
            border: 1px solid rgba(255,255,255,.05);
            padding: 9px 14px;
            border-radius: 10px;
            color: inherit;
            font-size: 14px;
            min-width: 280px;
            width: 280px;
        }

        .grid {
            display: grid;
            grid-auto-flow: dense;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .card {
            background: var(--glass);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: transform .15s;
            display: flex;
            flex-direction: column;
        }

        .card:hover {
            transform: translateY(-6px);
        }

        .thumb-wrapper {
            position: relative;
            width: 100%;
            padding-top: 100%;
            background: #111;
            border-radius: 6px;
            overflow: hidden;
            border: 4px solid rgba(160,170,180,0.3);
            box-sizing: border-box;
        }

        .thumb {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            object-position: center;
            image-rendering: auto;
            cursor: pointer;
            transition: transform .2s;
        }

        .thumb:hover {
            transform: scale(1.04);
        }

        .meta {
            padding: 8px 10px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            text-align: center;
        }

        .thumb-preview {
            position: fixed;
            top: 5vh;
            right: 5vw;
            width: 35vw;
            height: 35vw;
            max-width: 450px;
            max-height: 450px;
            border: 3px solid var(--accent);
            border-radius: 14px;
            box-shadow: 0 20px 60px rgba(0,0,0,.8);
            pointer-events: none;
            z-index: 999;
            opacity: 0;
            transition: opacity .25s;
            background: #000;
            image-rendering: pixelated;
            object-fit: contain;
        }

        .thumb-preview.visible {
            opacity: 1;
        }

        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,.85);
            display: flex;
            flex-direction: column;
            z-index: 80;
            opacity: 0;
            pointer-events: none;
            transition: .25s;
        }

        .modal.open {
            opacity: 1;
            pointer-events: auto;
        }

        .close-x {
            position: absolute;
            top: 16px;
            right: 18px;
            font-size: 22px;
            background: var(--panel);
            padding: 8px 12px;
            border-radius: 10px;
            cursor: pointer;
            z-index: 20;
        }

        .modal-title-overlay {
            position: absolute;
            top: 16px;
            left: 16px;
            background: var(--overlay-glass);
            backdrop-filter: blur(6px);
            padding: 12px 24px;
            border-radius: 12px;
            max-width: var(--content-max);
            z-index: 20;
            font-size: 14px;
            transition: opacity .4s;
            opacity: 0;
            text-align: center;
            gap: 8px;
        }

        .modal-title-overlay.visible {
            opacity: 1;
        }

        .modal-title-overlay strong {
            font-size: 17px;
            display: block;
            margin-bottom: 0;
        }

        .modal-title-overlay .date {
            color: var(--muted);
            font-size: 13px;
            margin-bottom: 10px;
            display: block;
        }

        .modal-details {
            position: absolute;
            background: var(--overlay-glass);
            backdrop-filter: blur(6px);
            padding: 20px;
            border-radius: 12px;
            max-width: var(--content-max);
            z-index: 20;
            font-size: 14px;
            line-height: 1.5;
            transition: opacity .4s .1s;
            opacity: 0;
            pointer-events: none;
            overflow-y: auto;
            max-height: 70vh;
            text-align: center;
        }

        .modal-details.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-viewport {
            flex: 1;
            background: #000;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: none;
            cursor: move;
        }

        .modal-controls {
            position: absolute;
            bottom: 16px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: row;
            gap: 40px;
            padding: 14px 20px;
            background: var(--overlay-glass);
            backdrop-filter: blur(6px);
            border-radius: 12px;
            z-index: 20;
            transition: opacity .4s;
            opacity: 0;
            width: calc(100% - 32px);
            max-width: var(--content-max);
            justify-content: space-between;
            align-items: center;
        }

        .modal-controls.visible {
            opacity: 1;
        }

        .view-controls, .action-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-width: 220px;
        }

        .fit-fill-row {
            display: flex;
            flex-direction: column;
            gap: 10px;
            justify-content: center;
        }

        .slider-row {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .slider-label {
            font-size: 11px;
            opacity: .8;
        }

        .slider-row input[type="range"] {
            width: 100%;
            height: 7px;
            -webkit-appearance: none;
            background: rgba(255,255,255,0.15);
            border-radius: 4px;
        }

        .slider-row input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: var(--accent);
            border-radius: 50%;
        }

        .modal-notification {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--overlay-glass);
            backdrop-filter: blur(6px);
            padding: 10px 20px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            color: var(--accent-bright);
            opacity: 0;
            transition: opacity 0.4s;
            z-index: 25;
        }

        #uiToggleBtn {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: var(--panel);
            border: 1px solid rgba(255,255,255,.08);
            box-shadow: var(--shadow);
            padding: 9px 14px;
            border-radius: 10px;
            font-size: 14px;
            color: inherit;
            cursor: pointer;
            z-index: 1000;
            transition: opacity .2s ease, transform .12s ease;
        }

        #uiToggleBtn:hover {
            transform: translateY(-2px);
        }

        body.ui-hidden #uiToggleBtn {
            opacity: 0.6;
        }

        body:not(.ui-hidden) #uiToggleBtn {
            opacity: 0.85;
        }

        .modal.open ~ #uiToggleBtn {
            display: none;
        }

        body.ui-hidden .wrap,
        body.ui-hidden .modal > *:not(#uiToggleBtn),
        body.ui-hidden .thumb-preview {
            opacity: 0 !important;
            pointer-events: none !important;
        }

        body.ui-hidden .bg-layer {
            filter: brightness(1) blur(0px);
        }

        @media (hover: none), (pointer: coarse) {
            .thumb-preview { display: none !important; }
            .thumb:hover { transform: none; }
        }

        @media (min-width: 769px) {
            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
                grid-template-rows: repeat(2, 1fr);
                align-items: stretch;
            }

            .grand-total        { grid-column: 1; grid-row: 1; }
            .total-maps          { grid-column: 1; grid-row: 2; }
            .group-contributions { grid-column: 2; grid-row: 1; }
            .maps-copied         { grid-column: 2; grid-row: 2; }
            .group-projects      { grid-column: 3; grid-row: 1 / 3; }

            .modal-title-overlay {
                left: 50%;
                transform: translateX(-50%);
                max-width: 60%;
            }

            .modal-details {
                left: 50%;
                top: 50%;
                transform: translate(-50%, -50%);
                max-width: 60%;
                padding: 24px;
            }

            .modal-controls {
                bottom: 32px;
                gap: 60px;
                padding: 20px 40px;
            }

            .view-controls { min-width: 260px; }
            .fit-fill-row { flex-direction: row; }
        }

        @media (max-width: 768px) {
            .wrap {
                padding: 0 8px;
            }

            .info-section {
                display: grid;
                grid-template-columns: repeat(2, minmax(0, 1fr));
                gap: 12px;
                align-items: start;
            }

            .top-header-row,
            .stats-grid {
                display: contents;
            }

            header,
            .award-banner,
            .contact-card,
            .stat-card,
            .group-projects {
                padding: 16px;
            }

            .grand-total         { grid-column: 1; grid-row: 2; }
            .total-maps          { grid-column: 2; grid-row: 2; }
            .group-contributions { grid-column: 1; grid-row: 3; }
            .maps-copied         { grid-column: 2; grid-row: 3; }
            .group-projects      { grid-column: 1; grid-row: 4; }

            header { grid-column: 1; grid-row: 1; }
            .award-banner { grid-column: 2; grid-row: 1; }
            .contact-card { grid-column: 2; grid-row: 4; }

            .logo {
                width: 50px;
                height: 50px;
            }

            .title-main { font-size: 21px; }
            .title-sub  { font-size: 12px; }

            .award-icon    { font-size: 28px; }
            .award-title   { font-size: 14px; }
            .award-subtitle { font-size: 11px; }

            .stat-value { font-size: 24px; }
            .stat-label { font-size: 11px; }
            .stat-sublabel { font-size: 10px; }

            .view-controls { display: none; }

            .modal-controls {
                max-width: var(--content-max);
                padding: 12px 16px;
                gap: 12px;
            }

            .action-controls {
                width: 100%;
                align-items: center;
                gap: 12px;
            }

            .action-controls button {
                width: 100%;
            }

            .modal-title-overlay,
            .modal-details {
                left: 50%;
                transform: translateX(-50%);
                max-width: 90%;
            }
            .title-main {
                font-size: 16px;
                line-height: 1.05;
                font-weight: 700;
            }
            .modal-details {
                top: 50%;
                transform: translate(-50%, -50%);
                max-height: 70vh;
            }
        }
    </style>
</head>
<body>

<div id="bgA" class="bg-layer"></div>
<div id="bgB" class="bg-layer"></div>

<div class="wrap">
    <div class="info-section">
        <div class="top-header-row">
            <header>
                <div class="logo"><img src="images/DTM.png" alt="Logo"></div>
                <div class="title-wrap">
                    <div class="title-main">DuctTapeMessiah</div>
                    <div class="title-sub">Mapartist since 1/13/2024</div>
                </div>
            </header>

            <div class="award-banner">
                <div class="award-icon">üèÜ</div>
                <div>
                    <div class="award-title">Best Mapartist of the Year</div>
                    <div class="award-subtitle">2025 Oscars Winner</div>
                    <a href="https://2b2toscars.com/" target="_blank" class="award-link">2b2tOscars.com ‚Üí</a>
                </div>
            </div>

            <div class="contact-card panel">
                <div class="social-label">Socials & Contact</div>
                <div class="social-links">
                    <a href="https://discord.com/users/ducttapemessiah" target="_blank" rel="noopener">Discord</a>
                    <a href="http://youtube.com/DuctTapeMessiah" target="_blank" rel="noopener">YouTube</a>
                    <a href="https://www.reddit.com/user/DuctTapeMessiah/" target="_blank" rel="noopener">Reddit</a>
                    <a href="https://github.com/DuctTapeMessiah/" target="_blank" rel="noopener">GitHub</a>
                </div>
                <div class="free-maps">Please contact me for free maps!</div>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card grand-total">
                <div class="stat-label">Grand Total</div>
                <div class="stat-value" id="grandTotal">-</div>
                <div class="stat-sublabel">All maps created</div>
            </div>

            <div class="stat-card total-maps">
                <div class="stat-label">Individual Maparts</div>
                <div class="stat-value" id="totalMaps">-</div>
                <div class="stat-sublabel">Individual Maparts created</div>
            </div>

            <div class="stat-card group-contributions">
                <div class="stat-label">Group Contributions</div>
                <div class="stat-value" id="groupMaps">-</div>
                <div class="stat-sublabel">Maps created in collaborative projects</div>
            </div>

            <div class="stat-card maps-copied">
                <div class="stat-label">Maps Copied</div>
                <div class="stat-value">479,752</div>
                <div class="stat-sublabel">As of January 11, 2026</div>
            </div>

            <div class="group-projects panel">
                <div class="group-projects-title">Group Projects</div>
                <div class="project-list"></div>
            </div>
        </div>
    </div>

    <div class="controls">
        <div class="controls-left">
            <div class="tabs">
                <button id="tabMapart" class="tab-btn active">My Mapart</button>
                <button id="tabScreens" class="tab-btn">My Screenshots</button>
            </div>
        </div>

        <div class="sort-grid">
            <button class="sort-btn active" data-sort="date-desc">Newest</button>
            <button class="sort-btn" data-sort="size-desc" id="sortLarge">Largest</button>
            <button class="sort-btn" data-sort="date-asc">Oldest</button>
            <button class="sort-btn" data-sort="size-asc" id="sortSmall">Smallest</button>
        </div>

        <input id="search" class="search-input" placeholder="Search...">
    </div>

    <div id="gallery" class="grid"></div>
</div>

<img id="hoverPreview" class="thumb-preview" alt="Preview">

<div id="modal" class="modal">
    <div class="close-x" id="modalClose">√ó</div>
    <div class="modal-title-overlay" id="modalTitleOverlay"></div>
    <div class="modal-details" id="modalDetails"></div>
    <div class="modal-viewport" id="modalViewport">
        <img id="modalImg" class="modal-img" alt="Full view">
        <div class="nav-arrow prev" id="prevBtn">‚Äπ</div>
        <div class="nav-arrow next" id="nextBtn">‚Ä∫</div>
    </div>
    <div class="modal-controls" id="modalControls">
        <div class="view-controls">
            <div class="slider-row"><span class="slider-label">Zoom</span><input id="zoomSlider" type="range" min="0.1" max="10" step="0.01" value="1"></div>
            <div class="slider-row"><span class="slider-label">Pan X</span><input id="panXSlider" type="range" min="-1" max="1" step="0.01" value="0"></div>
            <div class="slider-row"><span class="slider-label">Pan Y</span><input id="panYSlider" type="range" min="-1" max="1" step="0.01" value="0"></div>
        </div>
        <div class="action-controls">
            <div class="fit-fill-row">
                <button id="fitViewBtn">Fit</button>
                <button id="fillViewBtn">Fill</button>
            </div>
            <div class="action-row">
                <button id="copyBtn">Copy</button>
                <button id="downloadBtn">Download</button>
            </div>
        </div>
    </div>
    <div id="modalNotification" class="modal-notification"></div>
</div>

<button id="uiToggleBtn">Hide UI</button>

<script>
    const gallery = document.getElementById('gallery');
    const hover = document.getElementById('hoverPreview');
    const modal = document.getElementById('modal');
    const modalImg = document.getElementById('modalImg');
    const modalTitleOverlay = document.getElementById('modalTitleOverlay');
    const modalDetails = document.getElementById('modalDetails');
    const modalViewport = document.getElementById('modalViewport');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const zoomSlider = document.getElementById('zoomSlider');
    const panXSlider = document.getElementById('panXSlider');
    const panYSlider = document.getElementById('panYSlider');
    const modalControls = document.getElementById('modalControls');
    const fitViewBtn = document.getElementById('fitViewBtn');
    const fillViewBtn = document.getElementById('fillViewBtn');
    const uiToggleBtn = document.getElementById('uiToggleBtn');
    const modalNotification = document.getElementById('modalNotification');

    fitViewBtn.onclick = () => { fitView(); onUserInteract(); };
    fillViewBtn.onclick = () => { fillView(); onUserInteract(); };

    let mode = 'mapart';
    let sort = 'date-desc';
    let DATA = [];
    let SCREENSHOTS = [];
    let items = [];
    let currentIndex = -1;
    let uiTimeout;
    let uiHidden = false;
    let linkMap = {};
    let returnToMode = null;
    let returnToItem = null;

    const GROUP_PROJECTS = [
        { name: '2024 Family Feud',      date: '06/30/2024', maps: 116 },
        { name: '2024 Advent Calendar',  date: '12/25/2024', maps: 38 },
        { name: 'Bad Apple',             date: '10/02/2025', maps: 3599 },
        { name: '2025 Oscars',           date: '11/23/2025', maps: 361 },
        { name: '2025 Advent Calendar',  date: '12/25/2025', maps: 57 }
    ];

    const isTouchDevice = /Mobi|Android/i.test(navigator.userAgent);

    let state = {
        scale: 1,
        offsetX: 0,
        offsetY: 0,
        startX: 0,
        startY: 0,
        startOffsetX: 0,
        startOffsetY: 0,
        isPanning: false,
        detailsShown: false,
        initialFitScale: 1
    };

    let autoPanInterval = null;
    let panDirection = 1;

    function onUserInteract() {
        showUI();
        resetUITimeout();
    }

    function calculateStats() {
        let totalIndividualMaps = 0;
        DATA.forEach(m => {
            if (m.excludeFromCount !== true && m.totalMaps) {
                totalIndividualMaps += m.totalMaps;
            }
        });

        const groupTotal = GROUP_PROJECTS.reduce((sum, p) => sum + p.maps, 0);
        const grandTotal = totalIndividualMaps + groupTotal;

        const startDate = new Date('2024-01-13');
        const currentDate = new Date();
        const daysSince = Math.floor((currentDate - startDate) / (1000 * 60 * 60 * 24));
        const mapsPerDay = (grandTotal / daysSince).toFixed(2);

        document.getElementById('totalMaps').textContent = totalIndividualMaps.toLocaleString();
        document.getElementById('groupMaps').textContent = groupTotal.toLocaleString();
        document.getElementById('grandTotal').textContent = grandTotal.toLocaleString();

        document.querySelector('.title-sub').innerHTML =
            `Mapartist since 1/13/2024<br><span style="font-size:11px;opacity:0.7;">${mapsPerDay} maps per day</span>`;
    }

    function startAutoPan() {
        if (isTouchDevice) return;
        if (!modal.classList.contains('open') || autoPanInterval) return;

        const vpW = modalViewport.clientWidth;
        const vpH = modalViewport.clientHeight;
        const imgW = modalImg.naturalWidth;
        const imgH = modalImg.naturalHeight;

        if (!imgW || !imgH) return;

        const scaledW = state.scale * imgW;
        const scaledH = state.scale * imgH;

        const extraX = Math.max(0, (scaledW - vpW) / 2);
        const extraY = Math.max(0, (scaledH - vpH) / 2);

        const wideRatio = scaledW / vpW;
        const tallRatio = scaledH / vpH;

        if (wideRatio < 1.05 && tallRatio < 1.05) return;

        const isWide = wideRatio > tallRatio;
        const maxPan = isWide ? extraX : extraY;
        if (maxPan === 0) return;

        const speed = 30;
        const step = speed / 60;

        clearInterval(autoPanInterval);
        autoPanInterval = setInterval(() => {
            if (!modal.classList.contains('open')) {
                clearInterval(autoPanInterval);
                autoPanInterval = null;
                return;
            }

            if (isWide) {
                state.offsetX += step * panDirection;
                if (Math.abs(state.offsetX) >= maxPan) panDirection *= -1;
            } else {
                state.offsetY += step * panDirection;
                if (Math.abs(state.offsetY) >= maxPan) panDirection *= -1;
            }

            clampPan();
            updateTransform();
            syncSliders();
        }, 1000 / 60);
    }

    function stopAutoPan() {
        if (autoPanInterval) {
            clearInterval(autoPanInterval);
            autoPanInterval = null;
        }
    }

    async function loadJSON(url) {
        try {
            const res = await fetch(url);
            return res.ok ? await res.json() : [];
        } catch {
            return [];
        }
    }

    function toggleUIHide() {
        uiHidden = !uiHidden;
        document.body.classList.toggle('ui-hidden', uiHidden);
        uiToggleBtn.textContent = uiHidden ? 'Show UI' : 'Hide UI';
    }

    function buildLinkMap() {
        linkMap = {};

        SCREENSHOTS.forEach((s, i) => {
            if (s.mapart) {
                const match = DATA.find(m => m.title === s.mapart);
                if (match) {
                    linkMap[`screenshot-${i}`] = { type: 'mapart', title: match.title };
                    linkMap[`mapart-${match.title}`] = { type: 'screenshot', index: i };
                }
            }
        });

        DATA.forEach(m => {
            if (m.screenshot) {
                const idx = SCREENSHOTS.findIndex(s => s.title === m.screenshot);
                if (idx !== -1) {
                    linkMap[`mapart-${m.title}`] = { type: 'screenshot', index: idx };
                    linkMap[`screenshot-${idx}`] = { type: 'mapart', title: m.title };
                }
            }
        });
    }

    function populateProjectList() {
        const list = document.querySelector('.project-list');
        list.innerHTML = '';

        [...GROUP_PROJECTS]
            .sort((a, b) => new Date(b.date) - new Date(a.date))
            .forEach(p => {
                const item = document.createElement('div');
                item.className = 'project-item';

                const d = new Date(p.date);
                const dateStr = `${String(d.getMonth()+1).padStart(2,'0')}/${String(d.getDate()).padStart(2,'0')}/${String(d.getFullYear()).slice(-2)}`;

                item.innerHTML = `
                    <span>
                        <span class="project-date">${dateStr}</span>
                        <span class="project-name">${p.name}</span>
                    </span>
                    <span class="project-maps">${p.maps.toLocaleString('en-US')}</span>
                `;
                list.appendChild(item);
            });
    }

    async function boot() {
        DATA = await loadJSON('maps.json');
        SCREENSHOTS = await loadJSON('screenshots.json');

        buildLinkMap();

        await Promise.all(DATA.map(m => new Promise(resolve => {
            const img = new Image();
            img.src = m.image;
            img.onload = () => {
                m.pixelWidth = img.naturalWidth;
                m.pixelHeight = img.naturalHeight;
                m.w = Math.round(img.naturalWidth / 128);
                m.h = Math.round(img.naturalHeight / 128);
                m.totalMaps = m.w * m.h;
                resolve();
            };
            img.onerror = () => { m.totalMaps = 0; resolve(); };
        })));

        calculateStats();
        populateProjectList();

        uiToggleBtn.onclick = toggleUIHide;

        startBackgroundSlideshow(9000);
        render();
    }

    let bgToggle = false;
    let bgTimer = null;

    function startBackgroundSlideshow(interval = 9000) {
        if (!SCREENSHOTS.length) return;

        const bgA = document.getElementById('bgA');
        const bgB = document.getElementById('bgB');

        let shuffled = SCREENSHOTS.filter(s => s.show !== false);
        if (!shuffled.length) return;

        shuffled.sort(() => Math.random() - 0.5);
        let idx = 0;

        function next() {
            const src = shuffled[idx].image || `screenshots/${shuffled[idx].file}`;
            const incoming  = bgToggle ? bgA : bgB;
            const outgoing = bgToggle ? bgB : bgA;

            incoming.style.backgroundImage = `url('${src}')`;
            incoming.classList.add('active', 'animate');
            outgoing.classList.add('fadeout');

            setTimeout(() => {
                outgoing.classList.remove('active', 'animate', 'fadeout');
                outgoing.style.backgroundImage = '';
            }, 3000);

            bgToggle = !bgToggle;
            idx = (idx + 1) % shuffled.length;

            if (idx === 0) shuffled.sort(() => Math.random() - 0.5);
        }

        next();
        bgTimer = setInterval(next, interval);
    }

    function extractDateFromFilename(filename) {
        const match = filename.match(/(\d{4}-\d{2}-\d{2})/);
        return match ? match[1] : null;
    }

    function applySort(arr) {
        if (sort.startsWith('date')) {
            arr.sort((a, b) => {
                let da = a.date || a.dateBuilt || extractDateFromFilename(a.image) || '0';
                let db = b.date || b.dateBuilt || extractDateFromFilename(b.image) || '0';
                return sort === 'date-desc' ? new Date(db) - new Date(da) : new Date(da) - new Date(db);
            });
        } else if (mode === 'mapart') {
            arr.sort((a, b) => {
                const as = a.totalMaps || 0;
                const bs = b.totalMaps || 0;
                return sort === 'size-desc' ? bs - as : as - bs;
            });
        }
    }

    function render() {
        gallery.innerHTML = '';
        const query = document.getElementById('search').value.toLowerCase();
        const all = mode === 'mapart' ? DATA : SCREENSHOTS;

        items = all.filter(i => {
            if (mode === 'screens' && i.show === false) return false;
            return !query || (i.title || '').toLowerCase().includes(query);
        });

        applySort(items);

        document.getElementById('sortLarge').style.display = mode === 'mapart' ? '' : 'none';
        document.getElementById('sortSmall').style.display = mode === 'mapart' ? '' : 'none';

        items.forEach((item, i) => {
            const card = document.createElement('div');
            card.className = 'card';

            const wrapper = document.createElement('div');
            wrapper.className = 'thumb-wrapper';

            if (mode === 'mapart' && item.w && item.h) {
                let ratio = item.w / item.h;
                let spanX = Math.min(item.w, 4);
                let spanY = Math.min(item.h, 4);
                if (ratio > 3)  { spanX = Math.min(item.w, 6); spanY = 1; }
                if (ratio < 1/3){ spanX = 1; spanY = Math.min(item.h, 6); }
                wrapper.style.gridColumnEnd = `span ${spanX}`;
                wrapper.style.gridRowEnd   = `span ${spanY}`;
            }

            const thumb = document.createElement('img');
            thumb.className = 'thumb';
            thumb.src = item.thumb || item.image;
            thumb.loading = 'lazy';
            thumb.alt = item.title || 'Thumbnail';

            if (!isTouchDevice) {
                thumb.onmouseenter = () => { hover.src = item.image; hover.classList.add('visible'); };
                thumb.onmouseleave = () => hover.classList.remove('visible');
            }

            thumb.onclick = () => openModal(i);
            wrapper.appendChild(thumb);
            card.appendChild(wrapper);

            const meta = document.createElement('div');
            meta.className = 'meta';

            if (mode === 'mapart') {
                const maps = item.totalMaps ?? '?';
                const note = item.excludeFromCount ? ' <span style="font-size:10px;opacity:0.6;">(not counted)</span>' : '';
                meta.innerHTML = `
                    <div class="title">${item.title || ''}</div>
                    <div class="maps-tag">
                        <div style="font-size:11px;opacity:.75;">Total Maps</div>
                        <div style="font-size:14px;font-weight:800;">${maps}${note}</div>
                    </div>`;
            } else {
                meta.innerHTML = `<div class="title">${item.title || ''}</div>`;
            }

            card.appendChild(meta);
            gallery.appendChild(card);
        });
    }

    function showUI() {
        modalTitleOverlay.classList.add('visible');
        modalDetails.classList.toggle('visible', state.detailsShown);
        prevBtn.classList.add('visible');
        nextBtn.classList.add('visible');
        modalControls.classList.add('visible');
    }

    function hideUI() {
        modalTitleOverlay.classList.remove('visible');
        modalDetails.classList.remove('visible');
        prevBtn.classList.remove('visible');
        nextBtn.classList.remove('visible');
        modalControls.classList.remove('visible');
    }

    function resetUITimeout() {
        clearTimeout(uiTimeout);
        uiTimeout = setTimeout(hideUI, 3000);
    }

    function showNotification(text) {
        modalNotification.textContent = text;
        modalNotification.style.opacity = '1';
        clearTimeout(modalNotification._timeout);
        modalNotification._timeout = setTimeout(() => {
            modalNotification.style.opacity = '0';
        }, 3000);
    }

    function fitView() {
        if (!modalImg.naturalWidth) return;
        const scale = Math.min(
            modalViewport.clientWidth / modalImg.naturalWidth,
            modalViewport.clientHeight / modalImg.naturalHeight
        );
        state.initialFitScale = state.scale = scale;
        state.offsetX = state.offsetY = 0;
        updateTransform();
        syncSliders();
    }

    function fillView() {
        if (!modalImg.naturalWidth) return;
        const scale = Math.max(
            modalViewport.clientWidth / modalImg.naturalWidth,
            modalViewport.clientHeight / modalImg.naturalHeight
        );
        state.scale = scale;
        state.offsetX = state.offsetY = 0;
        clampPan();
        updateTransform();
        syncSliders();
    }

    function syncSliders() {
        zoomSlider.value = state.scale;

        const scaledW = state.scale * modalImg.naturalWidth;
        const scaledH = state.scale * modalImg.naturalHeight;

        const maxX = Math.max(0, (scaledW - modalViewport.clientWidth)  / 2);
        const maxY = Math.max(0, (scaledH - modalViewport.clientHeight) / 2);

        panXSlider.value = maxX ? state.offsetX / maxX : 0;
        panYSlider.value = maxY ? state.offsetY / maxY : 0;
    }

    function updateTransform() {
        modalImg.style.transform = `translate(${state.offsetX}px, ${state.offsetY}px) scale(${state.scale})`;
    }

    function clampPan() {
        const scaledW = state.scale * modalImg.naturalWidth;
        const scaledH = state.scale * modalImg.naturalHeight;

        const extraX = Math.max(0, (scaledW - modalViewport.clientWidth)  / 2);
        const extraY = Math.max(0, (scaledH - modalViewport.clientHeight) / 2);

        state.offsetX = Math.max(-extraX, Math.min(extraX, state.offsetX));
        state.offsetY = Math.max(-extraY, Math.min(extraY, state.offsetY));
    }

    function openModal(idx) {
        currentIndex = idx;
        const item = items[idx];
        if (!item) return;

        modal.classList.add('open');
        document.body.style.overflow = 'hidden';
        modalImg.src = item.image;

        let titleHtml = item.title ? `<strong>${item.title}</strong>` : '';

        let dateStr = item.date || item.dateBuilt || extractDateFromFilename(item.image);
        if (dateStr) {
            const d = new Date(dateStr);
            titleHtml += `<div class="date">Date Created: ${
                !isNaN(d) ? d.toLocaleDateString('en-US', { year:'numeric', month:'long', day:'2-digit' }) : dateStr
            }</div>`;
        }

        const desc = item.description || '';
        const credit = item.artistCredit || '';
        if (desc || credit) {
            titleHtml += `<button class="details-btn" id="toggleDetails">View Details</button>`;
        }

        const linkKey = mode === 'mapart' ? `mapart-${item.title}` : `screenshot-${SCREENSHOTS.indexOf(item)}`;
        const linked = linkMap[linkKey];

        if (linked) {
            const text = returnToMode
                ? (returnToMode === 'mapart' ? '‚Ü© Return to Mapart' : '‚Ü© Return to Screenshot')
                : (linked.type === 'screenshot' ? 'üì∏ In-Game Screenshot' : 'üé® View Mapart');
            titleHtml += `<button class="linked-btn" id="viewLinkedBtn">${text}</button>`;
        }

        modalTitleOverlay.innerHTML = titleHtml || '&nbsp;';

        modalDetails.innerHTML = (desc ? `<div class="desc">${desc}</div>` : '') +
                                (credit ? `<div class="credit">Artist: ${credit}</div>` : '');

        state.detailsShown = false;
        modalDetails.classList.remove('visible');

        document.getElementById('toggleDetails')?.addEventListener('click', () => {
            state.detailsShown = !state.detailsShown;
            document.getElementById('toggleDetails').textContent = state.detailsShown ? 'Hide Details' : 'View Details';
            modalDetails.classList.toggle('visible', state.detailsShown);
            onUserInteract();
        }, { once: true });

        document.getElementById('viewLinkedBtn')?.addEventListener('click', () => {
            if (returnToMode && returnToItem) {
                if (returnToMode === 'mapart') switchToMapart(returnToItem);
                else switchToScreenshots(returnToItem);
                returnToMode = returnToItem = null;
            } else if (linked) {
                if (linked.type === 'screenshot') {
                    returnToMode = 'mapart';
                    returnToItem = item.title;
                    switchToScreenshots(linked.index);
                } else {
                    returnToMode = 'screens';
                    returnToItem = SCREENSHOTS.indexOf(item);
                    switchToMapart(linked.title);
                }
            }
        }, { once: true });

        showUI();
        resetUITimeout();

        prevBtn.style.display = idx > 0 ? 'flex' : 'none';
        nextBtn.style.display = idx < items.length - 1 ? 'flex' : 'none';
    }

    function switchToScreenshots(globalIdx) {
    const shot = SCREENSHOTS[globalIdx];
    if (!shot) return;

    if (shot.show === false) {
        items = [shot];
        mode = 'screens';
        openModal(0);
        return;
    }

    closeModal(true); // Skip return logic
    mode = 'screens';
    document.body.classList.add('screens');
    document.body.classList.remove('mapart');
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.getElementById('tabScreens').classList.add('active');
    render();

    const target = items.findIndex(i => i === shot);
    if (target !== -1) setTimeout(() => openModal(target), 100);
}

function switchToMapart(title) {
    const mapart = DATA.find(m => m.title === title);
    if (!mapart) return;

    closeModal(true); // Skip return logic
    mode = 'mapart';
    document.body.classList.add('mapart');
    document.body.classList.remove('screens');
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.getElementById('tabMapart').classList.add('active');
    render();

    const target = items.findIndex(i => i === mapart);
    if (target !== -1) setTimeout(() => openModal(target), 100);
}



    function closeModal(skipReturn = false) {
         if (!skipReturn && returnToMode && returnToItem) {
        if (returnToMode === 'mapart') switchToMapart(returnToItem);
        else switchToScreenshots(returnToItem);
        returnToMode = returnToItem = null;
        return;
    }

    modal.classList.remove('open');
    document.body.style.overflow = '';
    currentIndex = -1;
    hideUI();
}

    zoomSlider.oninput = () => {
        state.scale = +zoomSlider.value;
        clampPan();
        updateTransform();
        syncSliders();
        onUserInteract();
    };

    panXSlider.oninput = () => {
        const max = Math.max(0, (state.scale * modalImg.naturalWidth - modalViewport.clientWidth) / 2);
        state.offsetX = +panXSlider.value * max;
        updateTransform();
        onUserInteract();
    };

    panYSlider.oninput = () => {
        const max = Math.max(0, (state.scale * modalImg.naturalHeight - modalViewport.clientHeight) / 2);
        state.offsetY = +panYSlider.value * max;
        updateTransform();
        onUserInteract();
    };

    modalViewport.addEventListener('wheel', e => {
        e.preventDefault();
        const factor = e.deltaY > 0 ? 0.9 : 1.1;
        state.scale = Math.max(0.1, Math.min(10, state.scale * factor));
        clampPan();
        updateTransform();
        syncSliders();
        onUserInteract();
    }, { passive: false });

    modalViewport.addEventListener('mousedown', e => {
        if (isTouchDevice) return;
        state.isPanning = true;
        state.startX = e.clientX;
        state.startY = e.clientY;
        state.startOffsetX = state.offsetX;
        state.startOffsetY = state.offsetY;
        modalViewport.style.cursor = 'grabbing';
    });

    document.addEventListener('mousemove', e => {
        if (!state.isPanning) return;
        state.offsetX = state.startOffsetX + (e.clientX - state.startX);
        state.offsetY = state.startOffsetY + (e.clientY - state.startY);
        clampPan();
        updateTransform();
        syncSliders();
    });

    document.addEventListener('mouseup', () => {
        if (state.isPanning) {
            state.isPanning = false;
            modalViewport.style.cursor = 'move';
        }
    });

    let lastTouchDistance = null;

    modalViewport.addEventListener('touchstart', e => {
        if (e.touches.length === 2) {
            lastTouchDistance = Math.hypot(
                e.touches[0].clientX - e.touches[1].clientX,
                e.touches[0].clientY - e.touches[1].clientY
            );
            state.startScale = state.scale;
        } else if (e.touches.length === 1) {
            state.startX = e.touches[0].clientX;
            state.startY = e.touches[0].clientY;
            state.startOffsetX = state.offsetX;
            state.startOffsetY = state.offsetY;
        }
    }, { passive: true });

    modalViewport.addEventListener('touchmove', e => {
        if (e.touches.length === 2) {
            const dist = Math.hypot(
                e.touches[0].clientX - e.touches[1].clientX,
                e.touches[0].clientY - e.touches[1].clientY
            );
            state.scale = Math.max(0.1, Math.min(10, state.startScale * (dist / lastTouchDistance)));
            clampPan();
            updateTransform();
            syncSliders();
        } else if (e.touches.length === 1) {
            state.offsetX = state.startOffsetX + (e.touches[0].clientX - state.startX);
            state.offsetY = state.startOffsetY + (e.touches[0].clientY - state.startY);
            clampPan();
            updateTransform();
            syncSliders();
        }
        onUserInteract();
    }, { passive: false });

    function navigate(delta) {
        const next = currentIndex + delta;
        if (next >= 0 && next < items.length) openModal(next);
    }

    prevBtn.onclick = () => { navigate(-1); onUserInteract(); };
    nextBtn.onclick = () => { navigate(1); onUserInteract(); };

    document.addEventListener('keydown', e => {
        if (modal.classList.contains('open')) {
            if (e.key === 'ArrowLeft')  navigate(-1);
            if (e.key === 'ArrowRight') navigate(1);
            if (e.key === 'Escape')     closeModal();
            onUserInteract();
        } else if (document.body.classList.contains('ui-hidden')) {
            if (e.key === 'Escape' || e.key === ' ') toggleUIHide();
        }
    });

    modal.onclick = e => { if (e.target === modal) closeModal(); };
    document.getElementById('modalClose').onclick = closeModal;

    document.getElementById('tabMapart').onclick = () => {
        mode = 'mapart';
        document.body.classList.add('mapart');
        document.body.classList.remove('screens');
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('tabMapart').classList.add('active');
        render();
    };

    document.getElementById('tabScreens').onclick = () => {
        mode = 'screens';
        document.body.classList.add('screens');
        document.body.classList.remove('mapart');
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('tabScreens').classList.add('active');
        render();
    };

    document.getElementById('search').oninput = () => setTimeout(render, 150);

    document.querySelectorAll('.sort-btn').forEach(btn => {
        btn.onclick = () => {
            sort = btn.dataset.sort;
            document.querySelectorAll('.sort-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            render();
        };
    });

    document.getElementById('copyBtn').onclick = async () => {
        onUserInteract();
        try {
            const res = await fetch(modalImg.src);
            if (!res.ok) throw new Error();
            const blob = await res.blob();
            await navigator.clipboard.write([new ClipboardItem({ [blob.type]: blob })]);
            showNotification('Copied to clipboard');
        } catch {
            showNotification('Copy failed');
        }
    };

    document.getElementById('downloadBtn').onclick = () => {
        onUserInteract();
        const a = document.createElement('a');
        a.href = modalImg.src;
        a.download = modalImg.src.split('/').pop() || 'image.png';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        showNotification('Download started');
    };

    modalImg.onload = () => {
        fitView();
        onUserInteract();
    };

    boot();

    window.addEventListener('load', () => document.body.classList.add('loaded'));
</script>
</body>
</html>