<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>DuctTapeMessiah ‚Äî 2B2T Gallery</title>
    <meta name="description" content="A collection of Mapart created and screenshots captured by DuctTapeMessiah on the Oldest Anarchy server in Minecraft, 2B2T.">
    <link rel="canonical" href="https://ducttapemessiah.art"/>

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://ducttapemessiah.art/">
    <meta property="og:title" content="DuctTapeMessiah ‚Äî 2B2T Gallery">
    <meta property="og:description" content="A collection of mapart created and screenshots captured by DuctTapeMessiah on the Oldest Anarchy server in Minecraft, 2B2T.">
    <meta property="og:image" content="https://ducttapemessiah.art/preview1.jpeg">

    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://ducttapemessiah.art/">
    <meta property="twitter:title" content="DuctTapeMessiah ‚Äî 2B2T Gallery">
    <meta property="twitter:description" content="A collection of mapart created and screenshots captured by DuctTapeMessiah on the Oldest Anarchy server in Minecraft, 2B2T.">
    <meta property="twitter:image" content="https://ducttapemessiah.art/preview1.jpeg">
    <style>
        :root {
          --bg: #0b0b0d;
          --panel: #0f1113;
          --muted: #94a3b8;
          --accent: #b6c7d6;
          --accent-bright: #d4e3f2;
          --glass: rgba(255,255,255,.025);
          --overlay-glass: rgba(15,17,19,.85);
          --shadow: 0 10px 30px rgba(0,0,0,.65);
          font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
        }

        html, body {
          margin: 0;
          height: 100%;
          font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
          color: #e6eef6;
          overflow-x: hidden;
        }

        .bg-layer {
          position: fixed;
          inset: 0;
          z-index: -1;
          background-size: cover;
          background-position: center;
          background-repeat: no-repeat;
          filter: brightness(0.65) blur(2px);
          opacity: 0;
          transition: opacity 3s ease-in-out;
          will-change: opacity, transform;
        }

        .bg-layer.active { opacity: 1; }
        .bg-layer.animate { animation: bgZoom 12s linear forwards; }

        @keyframes bgZoom {
            from { transform: scale(1); }
            to { transform: scale(1.08); }
        }

        .wrap { max-width: 1200px; margin: 24px auto; padding: 0 16px; }

        .top-header-row {
          display: flex;
          align-items: center;
          justify-content: space-between;
          gap: 20px;
          margin-bottom: 16px;
          flex-wrap: wrap;
        }

        header {
          display: flex;
          align-items: center;
          gap: 18px;
          padding: 16px 20px;
          background: var(--glass);
          border: 1px solid rgba(255,255,255,.08);
          border-radius: 12px;
          box-shadow: var(--shadow);
          backdrop-filter: blur(8px);
          flex: 1;
          min-width: 300px;
        }

        .logo { width: 70px; height: 70px; border-radius: 12px; overflow: hidden; flex-shrink: 0; }
        .logo img { width: 100%; height: 100%; object-fit: cover; }

        .title-wrap { flex: 1; }
        .title-main { font-size: 28px; font-weight: 800; color: #f1f5f9; line-height: 1.1; }
        .title-sub { font-size: 14px; color: #cbd5e1; font-weight: 500; }

        .award-banner {
          background: var(--glass);
          border: 1px solid rgba(255,255,255,.1);
          border-radius: 12px;
          padding: 16px 20px;
          box-shadow: var(--shadow);
          backdrop-filter: blur(8px);
          display: flex;
          align-items: center;
          gap: 16px;
          min-width: 360px;
          flex-shrink: 0;
        }

        .award-icon { font-size: 36px; flex-shrink: 0; }
        .award-title { font-size: 16px; font-weight: 800; color: #f1f5f9; margin-bottom: 2px; }
        .award-subtitle { font-size: 13px; color: #cbd5e1; }
        .award-link { font-size: 11px; color: #a5b4fc; text-decoration: none; }
        .award-link:hover { color: #c7d2fe; text-decoration: underline; }

        .info-row {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 16px;
          margin-bottom: 20px;
        }

        .stats-column .stats-container {
          display: flex;
          flex-direction: column;
          gap: 16px;
        }

        .right-column {
          display: flex;
          flex-direction: column;
          gap: 16px;
        }

        .stat-card {
          background: var(--glass);
          border: 1px solid rgba(255,255,255,.08);
          border-radius: 12px;
          padding: 16px;
          box-shadow: var(--shadow);
          backdrop-filter: blur(8px);
        }

        .stat-label { font-size: 12px; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 700; }
        .stat-value { font-size: 28px; font-weight: 800; color: var(--accent-bright); line-height: 1; }
        .stat-sublabel { font-size: 11px; color: var(--muted); margin-top: 4px; }

        .group-projects {
          background: var(--glass);
          border: 1px solid rgba(255,255,255,.08);
          border-radius: 12px;
          padding: 14px 16px;
          box-shadow: var(--shadow);
          backdrop-filter: blur(8px);
          height: fit-content;
        }

        .group-projects-title {
          font-size: 11px;
          font-weight: 700;
          color: var(--accent-bright);
          margin-bottom: 8px;
          text-transform: uppercase;
          letter-spacing: 0.5px;
        }

        .project-list { display: flex; flex-direction: column; gap: 4px; }
        .project-item {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 4px 8px;
          background: rgba(255,255,255,.02);
          border-radius: 6px;
          font-size: 10px;
        }

        .project-name { color: var(--accent); font-weight: 600; }
        .project-date { color: var(--muted); font-size: 9px; margin-right: 6px; }
        .project-maps { color: var(--accent-bright); font-weight: 700; font-size: 10px; }

        .contact-card {
          background: var(--glass);
          border: 1px solid rgba(255,255,255,.08);
          border-radius: 12px;
          padding: 16px;
          box-shadow: var(--shadow);
          backdrop-filter: blur(8px);
        }

        .social-label {
          font-size: 13px;
          font-weight: 700;
          color: var(--accent-bright);
          text-transform: uppercase;
          letter-spacing: 0.5px;
          margin-bottom: 10px;
        }

        .social-links {
          display: flex;
          flex-wrap: wrap;
          gap: 20px;
          font-size: 14px;
          margin-bottom: 12px;
        }

        .social-links a {
          color: var(--accent);
          text-decoration: none;
        }

        .social-links a:hover {
          color: var(--accent-bright);
          text-decoration: underline;
        }

        .free-maps {
          font-size: 15px;
          color: var(--accent-bright);
          font-weight: 600;
        }

        .controls {
          display: flex;
          gap: 14px;
          align-items: flex-start;
          flex-wrap: wrap;
          margin-bottom: 10px;
        }

        .controls-left {
          display: flex;
          flex-direction: column;
          gap: 12px;
        }

        .tabs { display: flex; gap: 8px; }
        .tab-btn, .sort-btn {
          background: var(--panel); border: 1px solid rgba(255,255,255,.08);
          padding: 9px 14px; border-radius: 10px; color: inherit; font-size: 14px;
          cursor: pointer; transition: .12s;
        }
        .tab-btn.active, .sort-btn.active { background: var(--accent); color: #000; font-weight: 700; }

        .sort-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; min-width: 280px; }
        .search-input {
          background: var(--panel); border: 1px solid rgba(255,255,255,.05);
          padding: 9px 14px; border-radius: 10px; color: inherit; font-size: 14px; min-width: 220px;
        }

        .grid {
          display: grid; grid-auto-flow: dense;
          grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
          gap: 16px; margin-top: 16px;
        }

        .card { background: var(--glass); border-radius: 12px; overflow: hidden; box-shadow: var(--shadow);
                transition: transform .15s; display: flex; flex-direction: column; }
        .card:hover { transform: translateY(-6px); }
        .thumb-wrapper { position: relative; width: 100%; padding-top: 100%; background: #111;
                         border-radius: 6px; overflow: hidden; border: 4px solid rgba(160,170,180,0.3); box-sizing: border-box; }
        .thumb {
          position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain;
          object-position: center; image-rendering: auto; cursor: pointer; transition: transform .2s;
        }
        .thumb:hover { transform: scale(1.04); }
        .meta { padding: 8px 10px; display: flex; flex-direction: column; gap: 6px; text-align: center; }

        .thumb-preview { position: fixed; top: 5vh; right: 5vw; width: 35vw; height: 35vw;
                         max-width: 450px; max-height: 450px; border: 3px solid var(--accent);
                         border-radius: 14px; box-shadow: 0 20px 60px rgba(0,0,0,.8); pointer-events: none;
                         z-index: 999; opacity: 0; transition: opacity .25s; background: #000;
                         image-rendering: pixelated; object-fit: contain; object-position: center; }
        .thumb-preview.visible { opacity: 1; }

        @media (hover:none),(pointer:coarse) { .thumb-preview { display: none !important; } .thumb:hover { transform: none; } }

        .modal { position: fixed; inset: 0; background: rgba(0,0,0,.85); display: flex; flex-direction: column;
                 z-index: 80; opacity: 0; pointer-events: none; transition: .25s; }
        .modal.open { opacity: 1; pointer-events: auto; }
        .modal-title-overlay { position: absolute; top: 16px; left: 16px; background: var(--overlay-glass);
                               backdrop-filter: blur(12px); padding: 12px 16px; border-radius: 12px; max-width: 60%;
                               z-index: 20; font-size: 14px; transition: opacity .4s; opacity: 0; }
        .modal-title-overlay.visible { opacity: 1; }
        .modal-title-overlay strong { font-size: 17px; display: block; margin-bottom: 4px; }
        .modal-title-overlay .date { color: var(--muted); font-size: 13px; margin-bottom: 10px; display: block; }
        .modal-title-overlay .details-btn { padding: 6px 12px; background: var(--panel); border: none;
                                            border-radius: 8px; color: inherit; font-size: 13px; cursor: pointer; width: 100%; margin-bottom: 6px; }
        .modal-title-overlay .linked-btn { padding: 6px 12px; background: rgba(182,199,214,0.15); border: 1px solid var(--accent);
                                            border-radius: 8px; color: var(--accent); font-size: 13px; cursor: pointer; width: 100%; }
        .modal-details { position: absolute; top: calc(16px + var(--title-height, 72px) + 10px); left: 16px;
                         background: var(--overlay-glass); backdrop-filter: blur(12px); padding: 12px 16px;
                         border-radius: 12px; max-width: 60%; z-index: 20; font-size: 14px; line-height: 1.5;
                         transition: opacity .4s .1s; opacity: 0; pointer-events: none; }
        .modal-details.visible { opacity: 1; pointer-events: auto; }
        .modal-details .desc { margin: 8px 0; color: #d0d8e2; }
        .modal-details .credit { font-size: 12px; color: var(--accent); margin-top: 8px; }
        .modal-viewport {
          flex: 1; background: #000; position: relative; overflow: hidden;
          display: flex; align-items: center; justify-content: center;
          touch-action: none; cursor: move; padding: 0; box-sizing: border-box;
        }
        .modal-img {
          image-rendering: auto; user-select: none; pointer-events: none;
          transform-origin: center center; max-width: none; max-height: none;
          width: auto; height: auto; object-fit: none;
          transition: transform 0.3s ease-out;
        }
        .nav-arrow { position: absolute; top: 50%; transform: translateY(-50%); width: 50px; height: 80px;
                     background: rgba(0,0,0,.5); border-radius: 8px; display: flex; align-items: center;
                     justify-content: center; font-size: 32px; color: #fff; cursor: pointer; z-index: 15;
                     opacity: 0; transition: opacity .1s; backdrop-filter: blur(4px); }
        .nav-arrow.visible { opacity: 0.3; }
        .nav-arrow:hover { opacity: 0.6; background: rgba(0,0,0,.7); }
        .nav-arrow.prev { left: 20px; }
        .nav-arrow.next { right: 20px; }
        .close-x { position: absolute; top: 16px; right: 18px; font-size: 22px; background: var(--panel);
                   padding: 8px 12px; border-radius: 10px; cursor: pointer; z-index: 20; }
        .modal-controls { position: absolute; top: 16px; right: 80px; display: flex; flex-direction: column;
                          gap: 6px; padding: 10px 12px; background: var(--overlay-glass); backdrop-filter: blur(12px);
                          border-radius: 10px; font-size: 10px; z-index: 20; transition: opacity .4s; opacity: 0;
                          min-width: 140px; align-items: center; }
        .modal-controls.visible { opacity: 1; }

        .fit-fill-row {
          display: flex;
          gap: 8px;
          width: 100%;
          justify-content: center;
        }

        .slider-row { display: flex; flex-direction: column; align-items: center; gap: 4px; width: 100%; }
        .slider-label { width: auto; font-size: 10px; opacity: .75; text-align: center; }
        .slider-row input[type="range"] { flex: 1; height: 6px; -webkit-appearance: none;
                                          background: rgba(255,255,255,0.15); border-radius: 4px; }
        .slider-row input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 14px;
                                                                height: 14px; background: var(--accent);
                                                                border-radius: 50%; cursor: pointer; }
        .slider-row button, .action-row button { padding: 6px 10px; font-size: 12px; background: var(--panel); border: none;
                             border-radius: 8px; cursor: pointer; color: inherit; min-width: 60px; }
        .action-row { display: flex; gap: 8px; margin-top: 10px; width: 100%; justify-content: center; }

        .modal-notification {
          position: absolute;
          bottom: 30px;
          left: 50%;
          transform: translateX(-50%);
          background: var(--overlay-glass);
          backdrop-filter: blur(12px);
          padding: 10px 20px;
          border-radius: 12px;
          font-size: 15px;
          font-weight: 600;
          color: var(--accent-bright);
          opacity: 0;
          transition: opacity 0.4s ease;
          pointer-events: none;
          z-index: 25;
          box-shadow: var(--shadow);
        }

        @media (max-width:968px) {
          .top-header-row { flex-direction: column; align-items: stretch; }
          header, .award-banner { min-width: auto; }
          .info-row { grid-template-columns: 1fr; }
        }

        @media (max-width: 768px) {
          .modal-title-overlay,
          .modal-details {
            left: 16px;
            max-width: calc(100% - 180px);
          }

          .modal-controls {
            top: 70px;
            right: 16px;
            min-width: 120px;
            padding: 8px 10px;
          }

          .close-x {
            top: 16px;
            right: 16px;
          }

          .fit-fill-row {
            flex-direction: column;
          }

          .action-row {
            flex-direction: column;
            gap: 6px;
          }

          .action-row button,
          .fit-fill-row button {
            font-size: 11px;
            padding: 5px 8px;
          }

          .slider-label {
            font-size: 9px;
          }

          .slider-row input[type="range"] {
            height: 5px;
          }

          .slider-row input[type="range"]::-webkit-slider-thumb {
            width: 12px;
            height: 12px;
          }

          .nav-arrow {
            width: 44px;
            height: 70px;
            font-size: 28px;
          }

          .nav-arrow.prev { left: 8px; }
          .nav-arrow.next { right: 8px; }
        }

        body.ui-hidden .wrap,
        body.ui-hidden .modal > *:not(#uiToggleBtn),
        body.ui-hidden .thumb-preview {
          opacity: 0 !important; pointer-events: none !important;
        }
        body.ui-hidden .bg-layer { filter: brightness(1) blur(0px); }
        #uiToggleBtn {
          position: fixed; bottom: 24px; right: 24px; background: var(--panel);
          border: 1px solid rgba(255,255,255,.08); box-shadow: var(--shadow);
          padding: 9px 14px; border-radius: 10px; font-size: 14px; color: inherit;
          cursor: pointer; z-index: 1000; transition: opacity .2s ease, transform .12s ease;
        }
        #uiToggleBtn:hover { transform: translateY(-2px); opacity: 1 !important; }
        body.ui-hidden #uiToggleBtn { opacity: 0.6; }
        body:not(.ui-hidden) #uiToggleBtn { opacity: 0.85; }
        .modal.open ~ #uiToggleBtn { display: none; }
    </style>
</head>
<body>
<div id="bgA" class="bg-layer"></div>
<div id="bgB" class="bg-layer"></div>

<div class="wrap">
    <div class="top-header-row">
        <header>
            <div class="logo"><img src="images/DTM.png" alt="Logo"></div>
            <div class="title-wrap">
                <div class="title-main">DuctTapeMessiah</div>
                <div class="title-sub">Mapartist since 1/13/2024</div>
            </div>
        </header>

        <div class="award-banner">
            <div class="award-icon">üèÜ</div>
            <div class="award-content">
                <div class="award-title">Best Mapartist of the Year</div>
                <div class="award-subtitle">2025 Oscars Winner</div>
                <a href="https://2b2toscars.com/" target="_blank" class="award-link">2b2toscars.com ‚Üí</a>
            </div>
        </div>
    </div>

    <div class="info-row">
        <div class="stats-column">
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-label">Total Maps</div>
                    <div class="stat-value" id="totalMaps">-</div>
                    <div class="stat-sublabel">Individual maparts created</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Group Contributions</div>
                    <div class="stat-value" id="groupMaps">-</div>
                    <div class="stat-sublabel">Maps in collaborative projects</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Grand Total</div>
                    <div class="stat-value" id="grandTotal">-</div>
                    <div class="stat-sublabel">All maps combined</div>
                </div>
            </div>
        </div>

        <div class="right-column">
            <div class="group-projects">
                <div class="group-projects-title">Group Projects</div>
                <div class="project-list">
                    <div class="project-item">
                        <span><span class="project-date">6/30/24</span><span class="project-name">2024 Family Feud</span></span>
                        <span class="project-maps">116</span>
                    </div>
                    <div class="project-item">
                        <span><span class="project-date">12/25/24</span><span class="project-name">2024 Advent Calendar</span></span>
                        <span class="project-maps">38</span>
                    </div>
                    <div class="project-item">
                        <span><span class="project-date">10/2/25</span><span class="project-name">Bad Apple</span></span>
                        <span class="project-maps">3,599</span>
                    </div>
                    <div class="project-item">
                        <span><span class="project-date">11/23/25</span><span class="project-name">2025 Oscars</span></span>
                        <span class="project-maps">361</span>
                    </div>
                    <div class="project-item">
                        <span><span class="project-date">12/25/25</span><span class="project-name">2025 Advent Calendar</span></span>
                        <span class="project-maps">57</span>
                    </div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-label">Maps Copied</div>
                <div class="stat-value">479,752</div>
                <div class="stat-sublabel">As of January 10, 2026</div>
            </div>

            <div class="contact-card">
                <div class="social-label">Socials & Contact</div>
                <div class="social-links">
                    <a href="https://discord.com/users/ducttapemessiah" target="_blank" rel="noopener">Discord</a>
                    <a href="http://youtube.com/DuctTapeMessiah" target="_blank" rel="noopener">YouTube</a>
                    <a href="https://www.reddit.com/user/DuctTapeMessiah/" target="_blank" rel="noopener">Reddit</a>
                    <a href="https://github.com/DuctTapeMessiah/" target="_blank" rel="noopener">GitHub</a>
                </div>
                <div class="free-maps">Please contact me for free maps!</div>
            </div>
        </div>
    </div>

    <div class="controls">
        <div class="controls-left">
            <div class="tabs">
                <button id="tabMapart" class="tab-btn active">My Mapart</button>
                <button id="tabScreens" class="tab-btn">Screenshots</button>
            </div>
        </div>

        <div class="sort-grid">
            <button class="sort-btn active" data-sort="date-desc">Newest</button>
            <button class="sort-btn" data-sort="size-desc" id="sortLarge">Largest</button>
            <button class="sort-btn" data-sort="date-asc">Oldest</button>
            <button class="sort-btn" data-sort="size-asc" id="sortSmall">Smallest</button>
        </div>

        <input id="search" class="search-input" placeholder="Search...">
    </div>

    <div id="gallery" class="grid"></div>
</div>

<img id="hoverPreview" class="thumb-preview" alt="Preview">

<div id="modal" class="modal">
    <div class="close-x" id="modalClose">√ó</div>
    <div class="modal-title-overlay" id="modalTitleOverlay"></div>
    <div class="modal-details" id="modalDetails"></div>
    <div class="modal-viewport" id="modalViewport">
        <img id="modalImg" class="modal-img" alt="Full view">
        <div class="nav-arrow prev" id="prevBtn">‚Äπ</div>
        <div class="nav-arrow next" id="nextBtn">‚Ä∫</div>
    </div>
    <div class="modal-controls" id="modalControls">
        <div class="fit-fill-row">
            <button id="fitViewBtn">Fit</button>
            <button id="fillViewBtn">Fill</button>
        </div>
        <div class="slider-row"><span class="slider-label">Zoom</span><input id="zoomSlider" type="range" min="0.1" max="10" step="0.01" value="1"></div>
        <div class="slider-row"><span class="slider-label">Pan X</span><input id="panXSlider" type="range" min="-1" max="1" step="0.01" value="0"></div>
        <div class="slider-row"><span class="slider-label">Pan Y</span><input id="panYSlider" type="range" min="-1" max="1" step="0.01" value="0"></div>
        <div class="action-row">
            <button id="copyBtn">Copy</button>
            <button id="downloadBtn">Download</button>
        </div>
    </div>
    <div id="modalNotification" class="modal-notification"></div>
</div>

<button id="uiToggleBtn">Hide UI</button>

<script>
    const gallery = document.getElementById('gallery');
    const hover = document.getElementById('hoverPreview');
    const modal = document.getElementById('modal');
    const modalImg = document.getElementById('modalImg');
    const modalTitleOverlay = document.getElementById('modalTitleOverlay');
    const modalDetails = document.getElementById('modalDetails');
    const modalViewport = document.getElementById('modalViewport');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const zoomSlider = document.getElementById('zoomSlider');
    const panXSlider = document.getElementById('panXSlider');
    const panYSlider = document.getElementById('panYSlider');
    const modalControls = document.getElementById('modalControls');
    const fitViewBtn = document.getElementById('fitViewBtn');
    const fillViewBtn = document.getElementById('fillViewBtn');
    const uiToggleBtn = document.getElementById('uiToggleBtn');
    const modalNotification = document.getElementById('modalNotification');

    if (fitViewBtn) fitViewBtn.onclick = () => { fitView(); showUI(); };
    if (fillViewBtn) fillViewBtn.onclick = () => { fillView(); showUI(); };

    let mode = 'mapart';
    let sort = 'date-desc';
    let DATA = [], SCREENSHOTS = [], items = [], currentIndex = -1, uiTimeout;
    let uiHidden = false;
    let linkMap = {};
    let returnToMode = null;
    let returnToItem = null;

    const GROUP_PROJECTS = [
        { name: '2024 Family Feud', date: '6/30/2024', maps: 116 },
        { name: '2024 Advent Calendar', date: '12/25/2024', maps: 38 },
        { name: 'Bad Apple', date: '10/2/2025', maps: 3599 },
        { name: '2025 Oscars', date: '11/23/2025', maps: 361 },
        { name: '2025 Advent Calendar', date: '12/25/2025', maps: 57 }
    ];

    const isTouchDevice = /Mobi|Android/i.test(navigator.userAgent);

    let state = {
      scale: 1,
      offsetX: 0,
      offsetY: 0,
      startX: 0,
      startY: 0,
      startOffsetX: 0,
      startOffsetY: 0,
      isPanning: false,
      detailsShown: false,
      initialFitScale: 1
    };

    let autoPanInterval = null;
    let panDirection = 1;

    function calculateStats() {
      let totalIndividualMaps = 0;

      DATA.forEach(m => {
        if (m.excludeFromCount !== true && m.totalMaps) {
          totalIndividualMaps += m.totalMaps;
        }
      });

      const groupTotal = GROUP_PROJECTS.reduce((sum, p) => sum + p.maps, 0);
      const grandTotal = totalIndividualMaps + groupTotal;

      document.getElementById('totalMaps').textContent = totalIndividualMaps.toLocaleString();
      document.getElementById('groupMaps').textContent = groupTotal.toLocaleString();
      document.getElementById('grandTotal').textContent = grandTotal.toLocaleString();
    }

    function startAutoPan() {
      if (!modal.classList.contains('open') || autoPanInterval) return;

      const vpW = modalViewport.clientWidth;
      const vpH = modalViewport.clientHeight;
      const imgW = modalImg.naturalWidth;
      const imgH = modalImg.naturalHeight;

      if (!imgW || !imgH) return;

      const scaledW = state.scale * imgW;
      const scaledH = state.scale * imgH;

      const extraX = Math.max(0, (scaledW - vpW) / 2);
      const extraY = Math.max(0, (scaledH - vpH) / 2);

      const wideRatio = scaledW / vpW;
      const tallRatio = scaledH / vpH;

      if (wideRatio < 1.05 && tallRatio < 1.05) return;

      const isWide = wideRatio > tallRatio;

      const maxPan = isWide ? extraX : extraY;
      if (maxPan === 0) return;

      const speed = 30;
      const step = (speed / 60);

      clearInterval(autoPanInterval);
      autoPanInterval = setInterval(() => {
        if (!modal.classList.contains('open')) {
          clearInterval(autoPanInterval);
          autoPanInterval = null;
          return;
        }

        if (isWide) {
          state.offsetX += step * panDirection;
          if (Math.abs(state.offsetX) >= maxPan) panDirection *= -1;
        } else {
          state.offsetY += step * panDirection;
          if (Math.abs(state.offsetY) >= maxPan) panDirection *= -1;
        }

        clampPan();
        updateTransform();
        syncSliders();
      }, 1000 / 60);
    }

    function stopAutoPan() {
      if (autoPanInterval) {
        clearInterval(autoPanInterval);
        autoPanInterval = null;
      }
    }

    async function loadJSON(u) {
      try {
        const r = await fetch(u);
        return r.ok ? await r.json() : [];
      } catch {
        return [];
      }
    }

    function toggleUIHide() {
        uiHidden = !uiHidden;
        if (uiHidden) {
            document.body.classList.add('ui-hidden');
            uiToggleBtn.textContent = 'Show UI';
        } else {
            document.body.classList.remove('ui-hidden');
            uiToggleBtn.textContent = 'Hide UI';
        }
    }

    function buildLinkMap() {
      linkMap = {};

      SCREENSHOTS.forEach((screenshot, sIdx) => {
        if (screenshot.mapart) {
          const mapartMatch = DATA.find(m => m.title === screenshot.mapart);
          if (mapartMatch) {
            linkMap[`screenshot-${sIdx}`] = { type: 'mapart', title: mapartMatch.title };
            linkMap[`mapart-${mapartMatch.title}`] = { type: 'screenshot', index: sIdx };
          }
        }
      });

      DATA.forEach(mapart => {
        if (mapart.screenshot) {
          const screenshotMatch = SCREENSHOTS.findIndex(s => s.title === mapart.screenshot);
          if (screenshotMatch !== -1) {
            linkMap[`mapart-${mapart.title}`] = { type: 'screenshot', index: screenshotMatch };
            linkMap[`screenshot-${screenshotMatch}`] = { type: 'mapart', title: mapart.title };
          }
        }
      });
    }

    async function boot() {
      DATA = await loadJSON('maps.json');
      SCREENSHOTS = await loadJSON('screenshots.json');

      buildLinkMap();

      await Promise.all(DATA.map(m => new Promise(resolve => {
        const img = new Image();
        img.src = m.image;
        img.onload = () => {
          m.pixelWidth = img.naturalWidth;
          m.pixelHeight = img.naturalHeight;
          m.w = Math.round(img.naturalWidth / 128);
          m.h = Math.round(img.naturalHeight / 128);
          m.totalMaps = m.w * m.h;
          resolve();
        };
        img.onerror = () => { m.totalMaps = 0; resolve(); };
      })));

      calculateStats();

      uiToggleBtn.onclick = toggleUIHide;

      startBackgroundSlideshow(9000);

      document.querySelector('[data-sort="date-desc"]').classList.add('active');
      render();
    }

    let bgToggle = false;
    let bgTimer = null;

    function startBackgroundSlideshow(interval = 9000) {
      if (!SCREENSHOTS.length) return;

      const bgA = document.getElementById('bgA');
      const bgB = document.getElementById('bgB');

      let shuffled = SCREENSHOTS.filter(s => s.show !== false);
      if (!shuffled.length) return;

      let currentIdx = 0;

      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }

      function nextBackground() {
        const next = shuffled[currentIdx];
        const src = next.image || `screenshots/${next.file}`;

        const incoming = bgToggle ? bgA : bgB;
        const outgoing = bgToggle ? bgB : bgA;

        incoming.style.backgroundImage = `url('${src}')`;
        incoming.classList.add('active', 'animate');
        incoming.classList.remove('fadeout');

        outgoing.classList.add('fadeout');

        setTimeout(() => {
            outgoing.classList.remove('active', 'animate', 'fadeout');
            outgoing.style.backgroundImage = '';
            outgoing.style.transform = '';
        }, 3000);

        bgToggle = !bgToggle;
        currentIdx = (currentIdx + 1) % shuffled.length;

        if (currentIdx === 0) {
          for (let i = shuffled.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
          }
        }
      }

      nextBackground();
      bgTimer = setInterval(nextBackground, interval);
    }

    function extractDateFromFilename(filename) {
      const match = filename.match(/(\d{4}-\d{2}-\d{2})/);
      return match ? match[1] : null;
    }

    function applySort(arr) {
      if (sort.startsWith('date')) {
        arr.sort((a, b) => {
          let da = a.date || a.dateBuilt || extractDateFromFilename(a.image) || '0';
          let db = b.date || b.dateBuilt || extractDateFromFilename(b.image) || '0';
          da = new Date(da);
          db = new Date(db);
          return sort === 'date-desc' ? db - da : da - db;
        });
      } else if (mode === 'mapart') {
        arr.sort((a, b) => {
          const aSize = a.totalMaps || 0;
          const bSize = b.totalMaps || 0;
          return sort === 'size-desc' ? bSize - aSize : aSize - bSize;
        });
      }
    }

    function render() {
      gallery.innerHTML = '';
      const q = document.getElementById('search').value.toLowerCase();
      const allItems = mode === 'mapart' ? DATA : SCREENSHOTS;
      items = allItems.filter(i => {
      if (mode === 'screens' && i.show === false) return false;
      return !q || (i.title || '').toLowerCase().includes(q);
      });
      applySort(items);

      document.getElementById('sortLarge').style.display = mode === 'mapart' ? '' : 'none';
      document.getElementById('sortSmall').style.display = mode === 'mapart' ? '' : 'none';

      items.forEach((m, idx) => {
        const c = document.createElement('div');
        c.className = 'card';

        const w = document.createElement('div');
        w.className = 'thumb-wrapper';

        if (mode === 'mapart' && m.w && m.h) {
          let ratio = m.w / m.h;
          let spanX = Math.min(m.w, 4);
          let spanY = Math.min(m.h, 4);
          if (ratio > 3) { spanX = Math.min(m.w, 6); spanY = 1; }
          if (ratio < 1/3) { spanX = 1; spanY = Math.min(m.h, 6); }
          w.style.gridColumnEnd = `span ${spanX}`;
          w.style.gridRowEnd = `span ${spanY}`;
        }

        const i = document.createElement('img');
        i.className = 'thumb';
        i.src = m.thumb || m.image;
        i.loading = 'lazy';
        i.alt = m.title || 'Thumbnail';

        if (!isTouchDevice) {
          i.onmouseenter = () => { hover.src = m.image; hover.classList.add('visible'); };
          i.onmouseleave = () => hover.classList.remove('visible');
        }

        i.onclick = () => openModal(idx);
        w.appendChild(i);
        c.appendChild(w);

        const meta = document.createElement('div');
        meta.className = 'meta';

        if (mode === 'mapart') {
          const maps = m.totalMaps ?? '?';
          const excludeNote = m.excludeFromCount ? ' <span style="font-size:10px;opacity:0.6;">(not counted)</span>' : '';
          meta.innerHTML = `<div class="title">${m.title || ''}</div><div class="maps-tag"><div style="font-size:11px;opacity:.75;">Total Maps</div><div style="font-size:14px;font-weight:800;">${maps}${excludeNote}</div></div>`;
        } else {
          meta.innerHTML = `<div class="title">${m.title || ''}</div>`;
        }

        c.appendChild(meta);
        gallery.appendChild(c);
      });
    }

    function showUI() {
        clearTimeout(uiTimeout);
        modalTitleOverlay.classList.add('visible');
        modalDetails.classList.toggle('visible', state.detailsShown);
        prevBtn.classList.add('visible');
        nextBtn.classList.add('visible');
        modalControls.classList.add('visible');
        uiTimeout = setTimeout(hideUI, 2500);
    }

    function hideUI() {
        modalTitleOverlay.classList.remove('visible');
        modalDetails.classList.remove('visible');
        prevBtn.classList.remove('visible');
        nextBtn.classList.remove('visible');
        modalControls.classList.remove('visible');
        startAutoPan();
    }

    function showNotification(text) {
      modalNotification.textContent = text;
      modalNotification.style.opacity = '1';
      clearTimeout(modalNotification._timeout);
      modalNotification._timeout = setTimeout(() => {
        modalNotification.style.opacity = '0';
      }, 3000);
    }

    function fitView() {
      if (!modalImg.naturalWidth || !modalImg.naturalHeight) return;

      const vpW = modalViewport.clientWidth;
      const vpH = modalViewport.clientHeight;

      const scale = Math.min(
        vpW / modalImg.naturalWidth,
        vpH / modalImg.naturalHeight
      );

      state.initialFitScale = scale;
      state.scale = scale;
      state.offsetX = 0;
      state.offsetY = 0;

      updateTransform();
      syncSliders();
    }

    function fillView() {
      if (!modalImg.naturalWidth) return;

      const vpW = modalViewport.clientWidth;
      const vpH = modalViewport.clientHeight;

      const scale = Math.max(
        vpW / modalImg.naturalWidth,
        vpH / modalImg.naturalHeight
      );

      state.scale = scale;
      state.offsetX = 0;
      state.offsetY = 0;
      clampPan();
      updateTransform();
      syncSliders();
    }

    function syncSliders() {
      zoomSlider.value = state.scale;
      const scaledW = state.scale * modalImg.naturalWidth;
      const scaledH = state.scale * modalImg.naturalHeight;
      const maxPanX = Math.max(0, (scaledW - modalViewport.clientWidth) / 2);
      const maxPanY = Math.max(0, (scaledH - modalViewport.clientHeight) / 2);
      const normX = maxPanX !== 0 ? state.offsetX / maxPanX : 0;
      const normY = maxPanY !== 0 ? state.offsetY / maxPanY : 0;
      panXSlider.value = normX;
      panYSlider.value = normY;
    }

    function updateTransform() {
      modalImg.style.transform = `translate(${state.offsetX}px, ${state.offsetY}px) scale(${state.scale})`;
    }

    function clampPan() {
      const scaledW = state.scale * modalImg.naturalWidth;
      const scaledH = state.scale * modalImg.naturalHeight;

      const extraX = Math.max(0, (scaledW - modalViewport.clientWidth) / 2);
      const extraY = Math.max(0, (scaledH - modalViewport.clientHeight) / 2);

      state.offsetX = Math.max(-extraX, Math.min(extraX, state.offsetX));
      state.offsetY = Math.max(-extraY, Math.min(extraY, state.offsetY));
    }

    function openModal(idx) {
      currentIndex = idx;
      const m = items[idx];
      if (!m) return;

      modal.classList.add('open');
      document.body.style.overflow = 'hidden';
      modalImg.src = m.image;

      let titleHtml = '';
      if (m.title) titleHtml += `<strong>${m.title}</strong>`;

      let dateStr = m.date || m.dateBuilt || extractDateFromFilename(m.image);
      if (dateStr) titleHtml += `<div class="date">${dateStr}</div>`;

      const desc = m.description || '';
      const credit = m.artistCredit || '';
      const hasDetails = desc || credit;

      if (hasDetails) {
        titleHtml += `<button class="details-btn" id="toggleDetails">View Details</button>`;
      }

      let linkKey;
      if (mode === 'mapart') {
        linkKey = `mapart-${m.title}`;
      } else {
        const globalIdx = SCREENSHOTS.indexOf(m);
        linkKey = `screenshot-${globalIdx}`;
      }

      const linkedContent = linkMap[linkKey];

      if (linkedContent) {
        let btnText = '';

        if (returnToMode === 'mapart') {
            btnText = '‚Ü© Return to Mapart';
        } else if (returnToMode === 'screens') {
            btnText = '‚Ü© Return to Screenshot';
        } else {
            btnText = linkedContent.type === 'screenshot'
            ? 'üì∏ In-Game Screenshot'
            : 'üé® View Mapart';
        }
        titleHtml += `<button class="linked-btn" id="viewLinkedBtn">${btnText}</button>`;
      }

      modalTitleOverlay.innerHTML = titleHtml || '&nbsp;';

      requestAnimationFrame(() => {
        const h = modalTitleOverlay.getBoundingClientRect().height;
        document.documentElement.style.setProperty('--title-height', `${h}px`);
      });

      let detailsHtml = '';
      if (desc) detailsHtml += `<div class="desc">${desc}</div>`;
      if (credit) detailsHtml += `<div class="credit">Artist: ${credit}</div>`;
      modalDetails.innerHTML = detailsHtml;

      state.detailsShown = false;
      modalDetails.classList.remove('visible');

      const toggleBtn = document.getElementById('toggleDetails');
      if (toggleBtn) {
        toggleBtn.onclick = () => {
          state.detailsShown = !state.detailsShown;
          toggleBtn.textContent = state.detailsShown ? 'Hide Details' : 'View Details';
          modalDetails.classList.toggle('visible', state.detailsShown);

          requestAnimationFrame(() => {
            const h = modalTitleOverlay.getBoundingClientRect().height;
            document.documentElement.style.setProperty('--title-height', `${h}px`);
          });

          showUI();
        };
      }

      const viewLinkedBtn = document.getElementById('viewLinkedBtn');
      if (viewLinkedBtn && linkedContent) {
        viewLinkedBtn.onclick = () => {
          if (returnToMode && returnToItem) {
            if (returnToMode === 'mapart') {
              const tempTitle = returnToItem;
              returnToMode = null;
              returnToItem = null;
              switchToMapart(tempTitle, false);
            } else {
              const tempIdx = returnToItem;
              returnToMode = null;
              returnToItem = null;
              switchToScreenshots(tempIdx, false);
            }
          } else {
            if (linkedContent.type === 'screenshot') {
              returnToMode = 'mapart';
              returnToItem = m.title;
              switchToScreenshots(linkedContent.index, true);
            } else if (linkedContent.type === 'mapart') {
              returnToMode = 'screens';
              const globalIdx = SCREENSHOTS.indexOf(m);
              returnToItem = globalIdx;
              switchToMapart(linkedContent.title, true);
            }
          }
        };
      }

      showUI();

      prevBtn.style.display = idx > 0 ? 'flex' : 'none';
      nextBtn.style.display = idx < items.length - 1 ? 'flex' : 'none';
    }

    function switchToScreenshots(screenshotGlobalIdx) {
      const screenshot = SCREENSHOTS[screenshotGlobalIdx];
      if (!screenshot) return;

      if (screenshot.show === false) {
        const savedReturnMode = returnToMode;
        const savedReturnItem = returnToItem;

        const tempItems = items;
        const tempMode = mode;

        items = [screenshot];
        mode = 'screens';

        openModal(0);

        items = tempItems;
        mode = tempMode;

        returnToMode = savedReturnMode;
        returnToItem = savedReturnItem;

        return;
      }

      modal.classList.remove('open');
      document.body.style.overflow = '';
      clearTimeout(uiTimeout);
      hideUI();
      stopAutoPan();

      mode = 'screens';
      document.body.classList.add('screens');
      document.body.classList.remove('mapart');
      document.querySelectorAll('.tab-btn').forEach(x => x.classList.remove('active'));
      document.getElementById('tabScreens').classList.add('active');
      render();

      const targetIdx = items.findIndex(item => item === screenshot);
      if (targetIdx !== -1) {
        setTimeout(() => openModal(targetIdx), 100);
      }
    }

    function switchToMapart(mapartTitle) {
      const mapart = DATA.find(m => m.title === mapartTitle);
      if (!mapart) return;

      modal.classList.remove('open');
      document.body.style.overflow = '';
      clearTimeout(uiTimeout);
      hideUI();
      stopAutoPan();

      mode = 'mapart';
      document.body.classList.add('mapart');
      document.body.classList.remove('screens');
      document.querySelectorAll('.tab-btn').forEach(x => x.classList.remove('active'));
      document.getElementById('tabMapart').classList.add('active');
      render();

      const targetIdx = items.findIndex(item => item === mapart);
      if (targetIdx !== -1) {
        setTimeout(() => openModal(targetIdx), 100);
      }
    }

    zoomSlider.oninput = () => {
      state.scale = parseFloat(zoomSlider.value);
      clampPan();
      updateTransform();
      syncSliders();
    };

    panXSlider.oninput = () => {
      const scaledW = state.scale * modalImg.naturalWidth;
      const maxPanX = Math.max(0, (scaledW - modalViewport.clientWidth) / 2);
      state.offsetX = parseFloat(panXSlider.value) * maxPanX;
      updateTransform();
    };

    panYSlider.oninput = () => {
      const scaledH = state.scale * modalImg.naturalHeight;
      const maxPanY = Math.max(0, (scaledH - modalViewport.clientHeight) / 2);
      state.offsetY = parseFloat(panYSlider.value) * maxPanY;
      updateTransform();
    };

    modalViewport.addEventListener('wheel', e => {
      e.preventDefault();
      const zoomFactor = e.deltaY > 0 ? 0.9 : 1.1;
      state.scale *= zoomFactor;
      state.scale = Math.max(0.1, Math.min(10, state.scale));
      clampPan();
      updateTransform();
      syncSliders();
      showUI();
    }, { passive: false });

    modalViewport.addEventListener('mousedown', e => {
      if (isTouchDevice) return;
      state.isPanning = true;
      state.startX = e.clientX;
      state.startY = e.clientY;
      state.startOffsetX = state.offsetX;
      state.startOffsetY = state.offsetY;
      modalViewport.style.cursor = 'grabbing';
    });

    document.addEventListener('mousemove', e => {
      if (!state.isPanning) return;
      const dx = e.clientX - state.startX;
      const dy = e.clientY - state.startY;
      state.offsetX = state.startOffsetX + dx;
      state.offsetY = state.startOffsetY + dy;
      clampPan();
      updateTransform();
      syncSliders();
    });

    document.addEventListener('mouseup', () => {
      if (state.isPanning) {
        state.isPanning = false;
        modalViewport.style.cursor = 'move';
      }
    });

    let lastTouchDistance = null;
    modalViewport.addEventListener('touchstart', e => {
      if (e.touches.length === 2) {
        lastTouchDistance = Math.hypot(
          e.touches[0].clientX - e.touches[1].clientX,
          e.touches[0].clientY - e.touches[1].clientY
        );
        state.startScale = state.scale;
      } else if (e.touches.length === 1) {
        state.startX = e.touches[0].clientX;
        state.startY = e.touches[0].clientY;
        state.startOffsetX = state.offsetX;
        state.startOffsetY = state.offsetY;
      }
    }, { passive: true });

    modalViewport.addEventListener('touchmove', e => {
      if (e.touches.length === 2) {
        const dist = Math.hypot(
          e.touches[0].clientX - e.touches[1].clientX,
          e.touches[0].clientY - e.touches[1].clientY
        );
        state.scale = state.startScale * (dist / lastTouchDistance);
        state.scale = Math.max(0.1, Math.min(10, state.scale));
        clampPan();
        updateTransform();
        syncSliders();
      } else if (e.touches.length === 1) {
        const dx = e.touches[0].clientX - state.startX;
        const dy = e.touches[0].clientY - state.startY;
        state.offsetX = state.startOffsetX + dx;
        state.offsetY = state.startOffsetY + dy;
        clampPan();
        updateTransform();
        syncSliders();
      }
    }, { passive: false });

    modalViewport.addEventListener('mousemove', showUI);
    modalViewport.addEventListener('touchstart', showUI, { passive: true });
    modalViewport.addEventListener('wheel', showUI, { passive: true });

    function navigate(delta) {
      const newIdx = currentIndex + delta;
      if (newIdx >= 0 && newIdx < items.length) openModal(newIdx);
    }

    prevBtn.onclick = () => { navigate(-1); showUI(); };
    nextBtn.onclick = () => { navigate(1); showUI(); };

    document.addEventListener('keydown', e => {
      if (modal.classList.contains('open')) {
        if (e.key === 'ArrowLeft') { navigate(-1); showUI(); }
        if (e.key === 'ArrowRight') { navigate(1); showUI(); }
        if (e.key === 'Escape') closeModal();
      } else if (document.body.classList.contains('ui-hidden')) {
        if (e.key === 'Escape' || e.key === ' ') {
          toggleUIHide();
        }
      }
    });

    modal.onclick = e => { if (e.target === modal) closeModal(); };
    document.getElementById('modalClose').onclick = closeModal;

    document.getElementById('tabMapart').onclick = () => {
      mode = 'mapart';
      document.body.classList.add('mapart');
      document.body.classList.remove('screens');
      document.querySelectorAll('.tab-btn').forEach(x => x.classList.remove('active'));
      document.getElementById('tabMapart').classList.add('active');
      render();
    };

    document.getElementById('tabScreens').onclick = () => {
      mode = 'screens';
      document.body.classList.add('screens');
      document.body.classList.remove('mapart');
      document.querySelectorAll('.tab-btn').forEach(x => x.classList.remove('active'));
      document.getElementById('tabScreens').classList.add('active');
      render();
    };

    document.getElementById('search').oninput = () => setTimeout(render, 150);

    document.querySelectorAll('.sort-btn').forEach(b => {
      b.onclick = () => {
        sort = b.dataset.sort;
        document.querySelectorAll('.sort-btn').forEach(x => x.classList.remove('active'));
        b.classList.add('active');
        render();
      };
    });

    function closeModal() {
      if (returnToMode && returnToItem) {
        const tempMode = returnToMode;
        const tempItem = returnToItem;
        returnToMode = null;
        returnToItem = null;

        if (tempMode === 'mapart') {
          switchToMapart(tempItem, false);
        } else {
          switchToScreenshots(tempItem, false);
        }
        return;
      }

      modal.classList.remove('open');
      document.body.style.overflow = '';
      currentIndex = -1;
      clearTimeout(uiTimeout);
      hideUI();
      stopAutoPan();
      returnToMode = null;
      returnToItem = null;
    }

    modalImg.onload = () => {
      fitView();
      startAutoPan();
    };

    document.getElementById('copyBtn').addEventListener('click', async () => {
      showUI();
      try {
        const response = await fetch(modalImg.src);
        if (!response.ok) throw new Error('Network error');
        const blob = await response.blob();
        await navigator.clipboard.write([new ClipboardItem({ [blob.type]: blob })]);
        showNotification('Copied to clipboard');
      } catch (err) {
        showNotification('Copy failed');
      }
    });

    document.getElementById('downloadBtn').addEventListener('click', () => {
      showUI();
      const a = document.createElement('a');
      a.href = modalImg.src;
      const filename = modalImg.src.split('/').pop() || 'image.png';
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      showNotification('Download should begin');
    });

    boot();
</script>
</body>
</html>