<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>DuctTapeMessiah — 2B2T Gallery</title>
    <link rel="canonical" href="https://ducttapemessiah.art"/>
    <style>
        :root{
            --bg:#0b0b0d;
            --panel:#0f1113;
            --muted:#94a3b8;
            --accent:#b6c7d6;
            --glass:rgba(255,255,255,.035);
            --shadow:0 10px 30px rgba(0,0,0,.65);
            font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial
        }
        html,body{
            margin:0;
            background:linear-gradient(180deg,var(--bg),#050506 120%);
            color:#e6eef6
        }
        .wrap{max-width:1200px;margin:28px auto;padding:18px}

        /* HEADER */
        header{
            display:flex;
            align-items:center;
            gap:18px;
            margin-bottom:18px
        }
        .logo{
            width:72px;height:72px;
            border-radius:12px;
            overflow:hidden
        }
        .logo img{width:100%;height:100%;object-fit:cover}
        .title-wrap{display:flex;flex-direction:column}
        .title-main{font-size:26px;font-weight:800;line-height:1.1}
        .title-sub{font-size:15px;color:var(--muted);font-weight:500}

        /* CONTROLS */
        .controls{
            display:flex;
            gap:14px;
            align-items:flex-start;
            flex-wrap:wrap;
            margin-bottom:10px
        }
        .controls-left{
            display:flex;
            flex-direction:column;
            gap:8px
        }
        .tabs{display:flex;gap:8px}
        .tab-btn,.sort-btn{
            background:var(--panel);
            border:1px solid rgba(255,255,255,.08);
            padding:9px 14px;
            border-radius:10px;
            color:inherit;
            font-size:14px;
            cursor:pointer;
            transition:.12s
        }
        .tab-btn.active,.sort-btn.active{
            background:var(--accent);
            color:#000;
            font-weight:700
        }
        .contact{font-size:12px;color:var(--muted)}
        .contact a{color:var(--accent);text-decoration:none}
        .sort-grid{
            display:grid;
            grid-template-columns:1fr 1fr;
            gap:8px;
            min-width:280px
        }
        .search-input{
            background:var(--panel);
            border:1px solid rgba(255,255,255,.05);
            padding:9px 14px;
            border-radius:10px;
            color:inherit;
            font-size:14px;
            min-width:220px
        }

        /* GALLERY */
        .grid{
            display:grid;
            grid-template-columns:repeat(auto-fill,minmax(180px,1fr));
            gap:14px;
            margin-top:16px
        }
        .card{
            background:var(--glass);
            border-radius:12px;
            overflow:hidden;
            box-shadow:var(--shadow);
            transition:transform .15s
        }
        .card:hover{transform:translateY(-6px)}

        .thumb-wrapper{
            width:100%;
            aspect-ratio:1 / 1;
            overflow:hidden;
            background:#000;
        }
        .thumb{
            width:100%;
            height:100%;
            object-fit:cover;
            object-position:center;
            image-rendering:pixelated;
            cursor:pointer;
            transition:transform .2s;
            loading:lazy;
        }
        .thumb:hover{
            transform:scale(1.05);
        }

        .meta{
            padding:8px 10px;
            display:flex;
            flex-direction:column;
            gap:6px
        }
        .meta .title{
            font-weight:600;
            font-size:14px
        }
        .maps-tag{
            align-self:flex-start;
            font-size:12px;
            padding:4px 9px;
            border-radius:999px;
            background:rgba(182,199,214,.18);
            color:var(--accent);
            font-weight:700
        }

        /* HOVER PREVIEW  */
        .thumb-preview{
            position:fixed;
            left:50%; top:50%;
            transform:translate(-50%,-50%);
            width:60vw;
            height:60vh;
            max-width:90vw;
            max-height:90vh;
            border:4px solid var(--accent);
            border-radius:14px;
            box-shadow:0 30px 90px rgba(0,0,0,.9);
            pointer-events:none;
            z-index:999;
            opacity:0;
            transition:opacity .2s;
            background:#000;
            image-rendering:pixelated;
            object-fit:contain;
            object-position:center;
        }
        .thumb-preview.visible{opacity:1}

        @media (hover: none), (pointer: coarse) {
            .thumb-preview { display:none !important; }
            .thumb:hover { transform:none; }
        }

        /* MODAL */
        .modal{
            position:fixed;
            inset:0;
            background:rgba(3,6,10,.94);
            display:flex;
            align-items:center;
            justify-content:center;
            z-index:80;
            opacity:0;
            pointer-events:none;
            transition:.25s
        }
        .modal.open{opacity:1;pointer-events:auto}
        #modalInner{
            width:95vw;
            height:95vh;
            max-width:1600px;
            background:var(--panel);
            border-radius:14px;
            overflow:hidden;
            display:flex;
            flex-direction:column
        }
        .modal-viewport{
            flex:1;
            background:#000;
            display:flex;
            align-items:center;
            justify-content:center;
            position:relative;
            overflow:hidden;
            touch-action:none;
        }
        .modal-img{
            max-width:none;
            max-height:none;
            image-rendering:pixelated;
            user-select:none;
            pointer-events:none;
            transition:transform .15s ease-out;
        }
        .modal-controls{
            padding:10px 14px;
            background:rgba(15,17,19,.95);
            font-size:13px;
            color:var(--muted);
            display:flex;
            align-items:center;
            justify-content:space-between;
        }
        .close-x{
            position:absolute;
            top:16px;
            right:18px;
            font-size:22px;
            background:var(--panel);
            padding:8px 12px;
            border-radius:10px;
            cursor:pointer;
            z-index:10;
        }

        /* SLIDER */
        .slider-column{
            display:flex;
            align-items:center;
            gap:12px;
        }
        .slider-column input[type="range"]{
            width:140px;
            height:6px;
            -webkit-appearance:none;
            background:rgba(255,255,255,0.15);
            border-radius:4px;
        }
        .slider-column input[type="range"]::-webkit-slider-thumb{
            -webkit-appearance:none;
            width:16px;
            height:16px;
            background:var(--accent);
            border-radius:50%;
            cursor:pointer;
        }
        .slider-column button{
            padding:6px 12px;
            background:var(--panel);
            border:none;
            border-radius:8px;
            color:inherit;
            font-size:13px;
            cursor:pointer;
        }
        @media (max-width:768px){
            .slider-column{display:none;}
        }
    </style>
</head>
<body>
<div class="wrap">
    <header>
        <div class="logo"><img src="images/DTM.png" alt="Logo"></div>
        <div class="title-wrap">
            <div class="title-main">DuctTapeMessiah</div>
            <div class="title-sub">2B2T Gallery</div>
        </div>
    </header>

    <div class="controls">
        <div class="controls-left">
            <div class="tabs">
                <button id="tabMapart" class="tab-btn active">My Mapart</button>
                <button id="tabScreens" class="tab-btn">Screenshots</button>
            </div>
            <div class="contact">
                Discord: <a href="https://discord.com/users/" target="_blank">DuctTapeMessiah</a>
            </div>
        </div>

        <div class="sort-grid" id="sortBar">
            <button class="sort-btn active" data-sort="date-desc">Newest</button>
            <button class="sort-btn" data-sort="size-desc" id="sortLarge">Largest</button>
            <button class="sort-btn" data-sort="date-asc">Oldest</button>
            <button class="sort-btn" data-sort="size-asc" id="sortSmall">Smallest</button>
        </div>

        <input id="search" class="search-input" placeholder="Search...">
    </div>

    <div id="gallery" class="grid"></div>
</div>

<img id="hoverPreview" class="thumb-preview" alt="Preview">
<div id="modal" class="modal">
    <div class="close-x" id="modalClose">×</div>
    <div id="modalInner">
        <div class="modal-viewport" id="modalViewport">
            <img id="modalImg" class="modal-img" alt="Full view">
        </div>
        <div class="modal-controls">
            <div id="modalMeta"></div>
            <div class="slider-column">
                <input type="range" id="zoomSlider" min="30" max="500" value="100" step="5">
                <button id="resetZoom">Fit</button>
            </div>
        </div>
    </div>
</div>

<script>
    const gallery = document.getElementById('gallery');
    const hover = document.getElementById('hoverPreview');
    const modal = document.getElementById('modal');
    const modalImg = document.getElementById('modalImg');
    const modalMeta = document.getElementById('modalMeta');
    const modalViewport = document.getElementById('modalViewport');
    const zoomSlider = document.getElementById('zoomSlider');
    const resetZoom = document.getElementById('resetZoom');

    let mode = 'mapart', sort = 'date-desc', DATA = [], SCREENSHOTS = [];
    let currentScale = 1;
    let isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

    async function loadJSON(u) {
        try { const r = await fetch(u); return r.ok ? await r.json() : []; } catch { return []; }
    }

    const base = n => n.split('/').pop().replace(/\.[^.]+$/, '');

    async function boot() {
        DATA = await loadJSON('maps.json');
        SCREENSHOTS = await loadJSON('screenshots.json');
        render();
    }

    function applySort(items) {
        if (sort.startsWith('date')) {
            items.sort((a, b) => {
                const da = new Date(a.date || a.dateBuilt || 0);
                const db = new Date(b.date || b.dateBuilt || 0);
                return sort === 'date-desc' ? db - da : da - db;
            });
        } else if (mode === 'mapart') {
            items.sort((a, b) => sort === 'size-desc' ? (b.total || 0) - (a.total || 0) : (a.total || 0) - (b.total || 0));
        }
    }

    function fitToScreen() {
        if (!modalImg.naturalWidth || !modalImg.naturalHeight) return;
        const padding = 60;
        const scaleX = (modalViewport.clientWidth - padding) / modalImg.naturalWidth;
        const scaleY = (modalViewport.clientHeight - padding) / modalImg.naturalHeight;
        currentScale = Math.min(scaleX, scaleY, 1);
        currentScale = Math.max(currentScale, 0.1);
        modalImg.style.transform = `scale(${currentScale})`;
        zoomSlider.value = Math.round(currentScale * 100);
    }

    function render() {
        gallery.innerHTML = '';
        const q = document.getElementById('search').value.toLowerCase();
        const items = (mode === 'mapart' ? DATA : SCREENSHOTS)
            .filter(i => !q || ((i.title || base(i.image)).toLowerCase().includes(q)));

        applySort(items);

        document.getElementById('sortLarge').style.display = mode === 'mapart' ? '' : 'none';
        document.getElementById('sortSmall').style.display = mode === 'mapart' ? '' : 'none';

        items.forEach(m => {
            const c = document.createElement('div'); c.className = 'card';
            const w = document.createElement('div'); w.className = 'thumb-wrapper';
            const i = document.createElement('img');
            i.className = 'thumb';
            i.src = m.thumb || m.image;
            i.alt = m.title || 'Thumbnail';
            i.loading = 'lazy';

            if (!isTouchDevice) {
                i.onmouseenter = () => { hover.src = m.image; hover.classList.add('visible'); };
                i.onmouseleave = () => hover.classList.remove('visible');
            }

            i.onclick = () => openModal(m);

            w.appendChild(i); c.appendChild(w);

            if (mode === 'mapart') {
                const meta = document.createElement('div'); meta.className = 'meta';
                meta.innerHTML = `<div class="title">${m.title || base(m.image)}</div><div class="maps-tag">${m.total || ''}</div>`;
                c.appendChild(meta);
            }

            gallery.appendChild(c);
        });
    }

    function openModal(m) {
        modal.classList.add('open');
        document.body.style.overflow = 'hidden';
        modalImg.src = m.image;
        modalMeta.innerHTML = `<strong style="color:#fff">${m.title || base(m.image)}</strong>`;

        currentScale = 1;
        modalImg.style.transform = 'scale(1)';

        modalImg.onload = () => {
            requestAnimationFrame(fitToScreen);
        };
    }

    function closeModal() {
        modal.classList.remove('open');
        document.body.style.overflow = '';
    }

    // Zoom slider
    zoomSlider.oninput = () => {
        currentScale = zoomSlider.value / 100;
        modalImg.style.transform = `scale(${currentScale})`;
    };

    // Fit button
    resetZoom.onclick = fitToScreen;

    // Basic touch pinch zoom (mobile)
    if (isTouchDevice) {
        let startDist = 0;
        modalViewport.addEventListener('touchstart', e => {
            if (e.touches.length === 2) {
                startDist = Math.hypot(
                    e.touches[0].pageX - e.touches[1].pageX,
                    e.touches[0].pageY - e.touches[1].pageY
                );
            }
        });
        modalViewport.addEventListener('touchmove', e => {
            if (e.touches.length === 2) {
                e.preventDefault();
                const currentDist = Math.hypot(
                    e.touches[0].pageX - e.touches[1].pageX,
                    e.touches[0].pageY - e.touches[1].pageY
                );
                const ratio = currentDist / startDist;
                currentScale = Math.max(0.3, Math.min(currentScale * ratio, 5));
                modalImg.style.transform = `scale(${currentScale})`;
                zoomSlider.value = Math.round(currentScale * 100);
                startDist = currentDist;
            }
        }, { passive: false });
    }

    modal.onclick = e => { if (e.target === modal) closeModal(); };
    document.getElementById('modalClose').onclick = closeModal;

    document.querySelectorAll('.sort-btn').forEach(b => {
        b.onclick = () => {
            sort = b.dataset.sort;
            document.querySelectorAll('.sort-btn').forEach(x => x.classList.remove('active'));
            b.classList.add('active');
            render();
        };
    });

    document.getElementById('tabMapart').onclick = () => {
        mode = 'mapart';
        document.querySelectorAll('.tab-btn').forEach(x => x.classList.remove('active'));
        document.getElementById('tabMapart').classList.add('active');
        render();
    };

    document.getElementById('tabScreens').onclick = () => {
        mode = 'screens';
        document.querySelectorAll('.tab-btn').forEach(x => x.classList.remove('active'));
        document.getElementById('tabScreens').classList.add('active');
        render();
    };

    document.getElementById('search').oninput = render;

    boot();
</script>
</body>
</html>